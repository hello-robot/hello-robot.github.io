<!-- Elements added to "main.html" will be displayed on all pages -->


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Hello Robot User Documentation">
      
      
        <meta name="author" content="Hello Robot Inc">
      
      
        <link rel="canonical" href="https://docs.hello-robot.com/0.3/ros2/align_to_aruco/">
      
      
      
      
      <link rel="icon" href="../../images/hello_robot_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Align to ArUco - Stretch Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    <!-- main.html | Added "navigation.instant" support -->
    <link rel="canonical" href=".">

   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="hello-robot-light" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#align-to-aruco" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Stretch Docs" class="md-header__button md-logo" aria-label="Stretch Docs" data-md-component="logo">
      
  <img src="../../images/hello_robot_logo_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stretch Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Align to ArUco
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="hello-robot-light" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Stretch Docs" class="md-nav__button md-logo" aria-label="Stretch Docs" data-md-component="logo">
      
  <img src="../../images/hello_robot_logo_light.png" alt="logo">

    </a>
    Stretch Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/hello_robot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello Robot!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/connecting_to_stretch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to Stretch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/stretch_hardware_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/writing_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/demos_mapping_and_navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo 1 - Mapping & Navigation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/demos_web_teleop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo 2 - Web Teleop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/community_resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/getting_help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting help
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hardware Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Hardware Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/safety_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Safety Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/hardware_guide_stretch_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch 3 Hardware Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/battery_maintenance_guide_se3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battery Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Software Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/distributions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/updating_software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/changelogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelogs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Installation Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/add_new_user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding a New User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/ros_workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating your ROS Workspace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/robot_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading your Operating System
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developing with Stretch
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developing with Stretch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developing/basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developing/onboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launching Apps on Boot
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/moving/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commanding Stretch to Move
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot/stretch_body/blob/master/docs/is_thread_safe/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thread Safety
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ROS 2 Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            ROS 2 Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jogging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Motion Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../robot_drivers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Drivers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Navigation with Nav2
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Navigation with Nav2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../navigation_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../navigation_stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nav2 Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../navigation_simple_commander/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nav2 Simple Commander
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot/stretch_ros2/tree/humble/stretch_funmap#overview" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUNMAP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perception
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Move Stretch with Twist Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../follow_joint_trajectory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trajectory Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../obstacle_avoider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obstacle Avoidance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collision Avoidance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rviz Markers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote_compute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Offloading Computation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ros2/align_to_aruco.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Align to ArUco
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArUco Locator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7_9" >
        
          
          <label class="md-nav__link" for="__nav_7_7_9" id="__nav_7_7_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Joints
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7_9">
            <span class="md-nav__icon md-icon"></span>
            Joints
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Joint States
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Static Transformations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Joint Effort
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ros2/deep_perception.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deep Perception
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter Laser Scans
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Realsense Camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microphones
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voice Teleop
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Simulation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Simulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch-mujoco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Mujoco
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot/stretch_ros2/tree/humble/stretch_simulation" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch ROS2 Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch-mujoco/docs/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started Notebook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch-mujoco/docs/using_mujoco_simulator_with_stretch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Mujoco API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://forum.hello-robot.com/t/physical-aspects-of-the-robot-for-simulation/792" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulation Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other Simulators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Other Simulators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/CardiffUniversityComputationalRobotics/stretch_ros2" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS2 with Gazebo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/google-deepmind/mujoco_menagerie/tree/main/hello_robot_stretch" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MuJoCo Menagerie
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extending Stretch
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Extending Stretch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extending_stretch/changing_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changing Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extending_stretch/urdf_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URDF Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extending_stretch/extending_stretch_additional_hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending Stretch with Additional Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Software Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch-body/docs/robot_parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch-body/docs/is_thread_safe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thread-safety Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-aruco-marker-dictionary" class="md-nav__link">
    <span class="md-ellipsis">
      The ArUco Marker Dictionary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The ArUco Marker Dictionary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-aruco-marker" class="md-nav__link">
    <span class="md-ellipsis">
      Create a New ArUco Marker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aruco-detection" class="md-nav__link">
    <span class="md-ellipsis">
      ArUco Detection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#computing-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Computing Transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-it-in-action" class="md-nav__link">
    <span class="md-ellipsis">
      See It In Action
    </span>
  </a>
  
    <nav class="md-nav" aria-label="See It In Action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#special-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Special Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-launch" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Launch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Code Breakdown
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Breakdown">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-setup-and-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Setup and Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-transform-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Transform Lookup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-aligntoaruco-class" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: AlignToAruco Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-compute-the-pose" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Compute the Pose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-move-the-base" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Move the Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="align-to-aruco">Align to ArUco<a class="headerlink" href="#align-to-aruco" title="Anchor link">&para;</a></h1>
<p>ArUco markers are a type of fiducials that are used extensively in robotics for identification and pose estimation. In this tutorial we will learn how to identify ArUco markers with the ArUco detection node and enable Stretch to navigate and align itself with respect to the marker.</p>
<p>There are three main parameters to creating an ArUco tag:</p>
<ul>
<li>Dictionary Size (Use 6x6_250 when using Stretch tutorials or ROS2 nodes, this is explained more <a href="#aruco-detection">below</a>)</li>
<li>ID (A unique identifier for the tag, see <a href="#create-a-new-aruco-marker">Create a New ArUco Marker</a> for reserved IDs)</li>
<li>Marker Size (The physical dimensions of the tag in mm, this can be customized freely.)</li>
</ul>
<h2 id="the-aruco-marker-dictionary">The ArUco Marker Dictionary<a class="headerlink" href="#the-aruco-marker-dictionary" title="Anchor link">&para;</a></h2>
<p>When defining the ArUco markers on Stretch, hello robot utilizes a YAML file, <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a>, that holds the information about the markers.</p>
<p>If <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/nodes/detect_aruco_markers">detect_aruco_markers</a> node doesn’t find an entry in <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a> for a particular ArUco marker ID number, it uses the default entry. For example, most robots have shipped with the following default entry:</p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;default&#39;</span><span class="p p-Indicator">:</span>
<span class="w">  </span><span class="s">&#39;length_mm&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class="w">  </span><span class="s">&#39;use_rgb_only&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="s">&#39;name&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;unknown&#39;</span>
<span class="w">  </span><span class="s">&#39;link&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
</code></pre></div>
<p>and the following entry for the ArUco marker on the top of the wrist</p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;133&#39;</span><span class="p p-Indicator">:</span>
<span class="w">  </span><span class="s">&#39;length_mm&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">23.5</span>
<span class="w">  </span><span class="s">&#39;use_rgb_only&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="s">&#39;name&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;wrist_top&#39;</span>
<span class="w">  </span><span class="s">&#39;link&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;link_aruco_top_wrist&#39;</span>
</code></pre></div>
<p><strong>Dictionary Breakdown</strong></p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;133&#39;</span><span class="p p-Indicator">:</span>
</code></pre></div>
<p>The dictionary key for each entry is the ArUco marker’s ID number or <code>default</code>. For example, the entry shown above for the ArUco marker on the top of the wrist assumes that the marker’s ID number is <code>133</code>.</p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;length_mm&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">23.5</span>
</code></pre></div>
<p>The <code>length_mm</code> value used by <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/nodes/detect_aruco_markers">detect_aruco_markers</a> is important for estimating the pose of an ArUco marker.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the actual width and height of the marker do not match this value, then pose estimation will be poor. Thus, carefully measure custom Aruco markers.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="s">&#39;use_rgb_only&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</code></pre></div>
<p>If <code>use_rgb_only</code> is <code>True</code>, <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/nodes/detect_aruco_markers">detect_aruco_markers</a> will ignore depth images from the <a href="https://www.intelrealsense.com/depth-camera-d435i/">Intel RealSense D435i depth camera</a> when estimating the pose of the marker and will instead only use RGB images from the D435i.</p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;name&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;wrist_top&#39;</span>
</code></pre></div>
<p><code>name</code> is used for the text string of the ArUco marker’s <a href="http://docs.ros.org/en/melodic/api/visualization_msgs/html/msg/Marker.html">ROS Marker</a> in the <a href="http://docs.ros.org/en/melodic/api/visualization_msgs/html/msg/MarkerArray.html">ROS MarkerArray</a> Message published by the <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/nodes/detect_aruco_markers">detect_aruco_markers</a> ROS node.</p>
<div class="highlight"><pre><span></span><code><span class="s">&#39;link&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;link_aruco_top_wrist&#39;</span>
</code></pre></div>
<p><code>link</code> is currently used by <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_calibration/nodes/collect_head_calibration_data">stretch_calibration</a>. It is the name of the link associated with a body-mounted ArUco marker in the <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_description/urdf/stretch_aruco.xacro">robot’s URDF</a>.</p>
<p>It’s good practice to add an entry to <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a> for each ArUco marker you use.</p>
<h3 id="create-a-new-aruco-marker">Create a New ArUco Marker<a class="headerlink" href="#create-a-new-aruco-marker" title="Anchor link">&para;</a></h3>
<p>At Hello Robot, we’ve used the following guide when generating new ArUco markers.</p>
<p>We generate ArUco markers using a 6x6-bit grid (36 bits) with 250 unique codes. This corresponds with <a href="https://docs.opencv.org/3.4/d9/d6a/group__aruco.html">DICT_6X6_250 defined in OpenCV</a>. We generate markers using this <a href="https://chev.me/arucogen/">online ArUco marker generator</a> by setting the Dictionary entry to 6x6 and then setting the Marker ID and Marker size, mm as appropriate for the specific application. We strongly recommend measuring the actual marker by hand before adding an entry for it to <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a>.</p>
<p>We select marker ID numbers using the following ranges.</p>
<ul>
<li>0 - 99: reserved for users</li>
<li>100 - 249: reserved for official use by Hello Robot Inc.</li>
<li>100 - 199: reserved for robots with distinct sets of body-mounted markers</li>
<li>Allows different robots near each other to use distinct sets of body-mounted markers to avoid confusion. This could be valuable for various uses of body-mounted markers, including calibration, visual servoing, visual motion capture, and multi-robot tasks.</li>
<li>5 markers per robot = 2 on the mobile base + 2 on the wrist + 1 on the shoulder</li>
<li>20 distinct sets = 100 available ID numbers / 5 ID numbers per robot</li>
<li>200 - 249: reserved for official accessories</li>
<li>245 for the prototype docking station</li>
<li>246-249 for large floor markers</li>
</ul>
<p>When coming up with this guide, we expected the following:</p>
<ul>
<li>Body-mounted accessories with the same ID numbers mounted to different robots could be disambiguated using the expected range of 3D locations of the ArUco markers on the calibrated body.</li>
<li>Accessories in the environment with the same ID numbers could be disambiguated using a map or nearby observable features of the environment.</li>
</ul>
<blockquote>
<p>Note: This section of the tutorial is borrowed from its <a href="https://github.com/hello-robot/stretch_tutorials/blob/master/ros1/aruco_marker_detection.md">ROS1 predecessor</a>.</p>
</blockquote>
<h2 id="aruco-detection">ArUco Detection<a class="headerlink" href="#aruco-detection" title="Anchor link">&para;</a></h2>
<p>Stretch uses the OpenCV ArUco detection library and is configured to identify a specific set of ArUco markers belonging to the 6x6, 250 dictionary. To understand why this is important, please refer to <a href="https://docs.opencv.org/4.x/d5/dae/tutorial_aruco_detection.html">this</a> handy guide provided by OpenCV.</p>
<p>Stretch comes preconfigured to identify ArUco markers. The ROS node that enables this is the <a href="https://github.com/hello-robot/stretch_ros2/blob/humble/stretch_core/stretch_core/detect_aruco_markers.py">detect_aruco_markers node</a> in the stretch_core package. Thanks to this node, identifying and estimating the pose of a marker is as easy as pointing the camera at the marker and running the detection node. It is also possible and quite convenient to visualize the detections with RViz.</p>
<h2 id="computing-transformations">Computing Transformations<a class="headerlink" href="#computing-transformations" title="Anchor link">&para;</a></h2>
<p>If you have not already done so, now might be a good time to review the <a href="https://docs.hello-robot.com/latest/ros2/example_10/">tf listener</a> tutorial. Go on, we can wait...
Now that we know how to program stretch to return the transform between known reference frames, we can use this knowledge to compute the transform between the detected marker and the robot's base_link. From its current pose, for Stretch to align itself in front of the marker, we need to command it to reach there. But even before that, we need to program Stretch to know the goal pose. We define the goal pose to be 0.75 meter outward from the marker in the marker negative y-axis (Green axis). This is easier to visualize through the figure below.</p>
<p align="center">
    <a class="glightbox" href="https://user-images.githubusercontent.com/97639181/196329130-986c3af9-6dc9-4d9b-8a74-626d12b1d82c.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="https://user-images.githubusercontent.com/97639181/196329130-986c3af9-6dc9-4d9b-8a74-626d12b1d82c.png" width="400"></a>
</p>

<p>By monitoring the /aruco/marker_array and /aruco/axes topics, we can visualize the markers in RViz. The detection node also publishes the tf pose of the detected markers. This can be visualized by using the TF plugin and selecting the detected marker to inspect the pose. Next, we will use exactly that to compute the transform between the detected marker and the base_link of the robot.</p>
<p>Now, we can compute the transformation from the robot <code>base_link</code> frame to the <code>goal</code> pose and pass this as a 2D special Euclidian (SE2) pose to the mobile base.</p>
<p>Since we want Stretch to stop at a fixed distance with respect to the marker, we define a 0.75m offset in the marker y-axis where Stretch would come to a stop.</p>
<p>At the same time, we also want Stretch to align its orientation to point its arm towards the marker so as to make the subsequent manipulation tasks easier to accomplish. This would result in the end pose of the base_link as shown in the above figure. Sweet!</p>
<p>The next task is to generate a simple motion plan for the mobile base to reach this end pose. We do this in three steps:</p>
<ol>
<li>Turn <code>phi</code> (φ) degrees towards the goal position. This would be the angle formed between the robot x-axis and the line connecting the start and the goal positions.</li>
<li>Travel straight to the goal position. This would be the euclidean distance between the start and the goal positions.</li>
<li>Turn <code>z_rot_base</code> degrees to attain the goal orientation. This would be the correction angle necessary to align the robot with the marker.</li>
</ol>
<div class="alignment-visualization">
  <div class="container">
    <canvas id="canvas" width="500" height="500"></canvas>
    <div class="controls">
      <label>
        Offset Distance (m)
        <input type="range" id="offset" min="0." max="1.5" step="0.05" value="0.75">
        <span id="offsetVal">0.75</span>
      </label>

      <label>
        Marker X Position (m)
        <input type="range" id="markerX" min="-2.0" max="2.0" step="0.05" value="1.2">
        <span id="markerXVal">1.2</span>
      </label>

      <label>
        Marker Y Position (m)
        <input type="range" id="markerY" min="-2.0" max="2.0" step="0.05" value="1.2">
        <span id="markerYVal">1.2</span>
      </label>

      <label>
        Marker Rotation (°)
        <input type="range" id="markerRot" min="-180" max="180" step="5" value="-90">
        <span id="markerRotVal">-90</span>
      </label>

      <div class="button-group">
        <button onclick="resetInputs()">Reset</button>
        <button id="animateButton" onclick="startAnimation()">Animate Robot</button>
      </div>
    </div>

  </div>
</div>

<p><link rel="stylesheet" href="../css/align_to_aruco_vis.css"></p>
<script src="../js/align_to_aruco_vis.js"></script>

<blockquote>
<p>You can adjust the marker's position, orientation, and offset distance using the sliders to see how these parameters affect the robot's alignment. Additionally, you can click the "Animate Robot" button to visualize the robot's trajectory from its initial pose to the final aligned position.</p>
</blockquote>
<p>Luckily, we know how to command Stretch to execute a trajectory using the joint trajectory server. If you are just starting, have a look at the <a href="https://docs.hello-robot.com/latest/ros2/follow_joint_trajectory/">Follow Joint Trajectory Commands</a> tutorial to know how to command Stretch using the Joint trajectory Server.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since we won't be using the arm for this demo, it's safer to stow Stretch's arm in. Run <code>stretch_robot_stow.py</code> from anywhere on a terminal.</p>
<div class="shell-prompt highlight"><pre><span></span><code>stretch_robot_stow.py
</code></pre></div>
</div>
<h2 id="see-it-in-action">See It In Action<a class="headerlink" href="#see-it-in-action" title="Anchor link">&para;</a></h2>
<p>First, we need to point the camera towards the marker. To do this, you could use the keyboard teleop node. To do this, run:</p>
<div class="shell-prompt highlight"><pre><span></span><code>ros2<span class="w"> </span>launch<span class="w"> </span>stretch_core<span class="w"> </span>keyboard_teleop.launch.py
</code></pre></div>
<p>When you are ready, execute the following command:</p>
<div class="shell-prompt highlight"><pre><span></span><code>ros2<span class="w"> </span>launch<span class="w"> </span>stretch_core<span class="w"> </span>align_to_aruco.launch.py
</code></pre></div>
<p align="center">
    <a class="glightbox" href="https://user-images.githubusercontent.com/97639181/196327520-7a3b6743-8e2c-4ec0-8603-ba9baff7aa34.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="https://user-images.githubusercontent.com/97639181/196327520-7a3b6743-8e2c-4ec0-8603-ba9baff7aa34.gif" width="400"></a>
</p>

<h4 id="special-considerations">Special Considerations<a class="headerlink" href="#special-considerations" title="Anchor link">&para;</a></h4>
<ol>
<li>Since we won't be using the arm for this demo, it's safer to stow Stretch's arm in. Run <code>stretch_robot_stow.py</code> from anywhere on a terminal.</li>
<li>The ArUco tag needs to be laid flat and rotated to match the image in <a href="#computing-transformations">Computing Transformations</a> above.</li>
<li>The robot will move 0.75m away from the marker. This means that if the robot is within 0.75m, then it will rotate and move forward until it is at 0.75m. If the robot is too close while rotating, it may collide with its surroundings.</li>
<li>If you wish to use a custom ArUco tag, you should 1. <a href="#create-a-new-aruco-marker">create a tag</a>. 2. print it so you can place it in your environment. 3. Duplicate the <code>131</code> <code>base_right</code> marker in <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a> and replace <code>131</code> with your marker's ID, <code>base_right</code> with a new name, and the <code>marker_size</code>, if it is different. 4. Lastly, you will need to pass the <code>aruco_tag_name</code> rosparam to the <code>stretch_aruco.py</code> node. You can do this either by editing the <code>align_to_aruco.launch.py</code> file or following the <a href="#manual-launch">Manual Launch</a> steps below.</li>
</ol>
<h3 id="manual-launch">Manual Launch<a class="headerlink" href="#manual-launch" title="Anchor link">&para;</a></h3>
<p>Instead of using the launch file, you can also run the following commands. This allows you to specify a custom ArUco tag name to the <code>align_to_aruco.py</code> node. The custom tag name must be defined in <a href="https://github.com/hello-robot/stretch_ros/blob/master/stretch_core/config/stretch_marker_dict.yaml">stretch_marker_dict.yaml</a>:</p>
<div class="highlight"><pre><span></span><code>roslaunch stretch_core stretch_driver.launch
roslaunch stretch_core d435i_low_resolution.launch
roslaunch stretch_core stretch_aruco.launch --ros-args -p aruco_tag_name:=base_right
rosrun rviz rviz -d /home/hello-robot/catkin_ws/src/stretch_tutorials/rviz/aruco_detector_example.rviz
</code></pre></div>
<h2 id="code-breakdown">Code Breakdown<a class="headerlink" href="#code-breakdown" title="Anchor link">&para;</a></h2>
<p>Let’s walk through the updated code to understand how the ArUco-based alignment works under the hood. You can follow along with the full script <a href="https://github.com/hello-robot/stretch_ros2/blob/humble/stretch_core/stretch_core/align_to_aruco.py">here</a>.</p>
<h3 id="step-1-setup-and-parameters">Step 1: Setup and Parameters<a class="headerlink" href="#step-1-setup-and-parameters" title="Anchor link">&para;</a></h3>
<p>We begin by initializing the ROS 2 node and TF listener. The name of the ArUco marker to align to is the launch file parameter (default: <code>"base_right"</code>), see the <a href="#special-considerations">Special Considerations</a> section above for using a custom ArUco marker.</p>
<div class="highlight"><pre><span></span><code><span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;align_to_aruco_node&quot;</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s2">&quot;aruco_tag_name&quot;</span><span class="p">,</span> <span class="s2">&quot;base_right&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="step-2-transform-lookup">Step 2: Transform Lookup<a class="headerlink" href="#step-2-transform-lookup" title="Anchor link">&para;</a></h3>
<p>The code repeatedly tries to find the transform between <code>base_link</code> and the given ArUco marker frame (e.g., <code>base_right</code>).</p>
<div class="highlight"><pre><span></span><code><span class="n">tf_buffer</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">()</span>
<span class="n">TransformListener</span><span class="p">(</span><span class="n">tf_buffer</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
<span class="n">trans_base</span> <span class="o">=</span> <span class="n">tf_buffer</span><span class="o">.</span><span class="n">lookup_transform</span><span class="p">(</span><span class="s2">&quot;base_link&quot;</span><span class="p">,</span> <span class="n">aruco_tag_name</span><span class="p">,</span> <span class="n">Time</span><span class="p">())</span>
</code></pre></div>
<p>If the marker cannot be detected or the transform cannot be looked up within the timeout, the script prints a helpful message:</p>
<div class="highlight"><pre><span></span><code>Could not detect the ArUco marker.
Please make sure the camera is manually pointed at the marker.
Please also make sure that the marker is upright—an incorrect orientation will result in an incorrect movement.
The robot will move when the marker is found.
</code></pre></div>
<hr />
<h3 id="step-3-aligntoaruco-class">Step 3: AlignToAruco Class<a class="headerlink" href="#step-3-aligntoaruco-class" title="Anchor link">&para;</a></h3>
<p>Once the transform is found, we pass it to the <code>AlignToAruco</code> class, which handles computing the desired pose and sending movement goals:</p>
<div class="highlight"><pre><span></span><code><span class="n">align</span> <span class="o">=</span> <span class="n">AlignToAruco</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">trans_base</span><span class="o">=</span><span class="n">trans_base</span><span class="p">)</span>
<span class="n">align</span><span class="o">.</span><span class="n">align_to_marker</span><span class="p">()</span>
</code></pre></div>
<p>This class initializes an action client to communicate with the base controller:</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">trajectory_client</span> <span class="o">=</span> <span class="n">ActionClient</span><span class="p">(</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
    <span class="n">FollowJointTrajectory</span><span class="p">,</span>
    <span class="s2">&quot;/stretch_controller/follow_joint_trajectory&quot;</span>
<span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="step-4-compute-the-pose">Step 4: Compute the Pose<a class="headerlink" href="#step-4-compute-the-pose" title="Anchor link">&para;</a></h3>
<blockquote>
<p>Refer to <a href="#computing-transformations">Computing Transformations</a> above for graphical explanation</p>
</blockquote>
<p>The robot computes how it should align to the marker using homogeneous transformations. It applies a 75 cm offset in the marker's frame and transforms it to the base frame:</p>
<div class="highlight"><pre><span></span><code><span class="n">R</span> <span class="o">=</span> <span class="n">quaternion_matrix</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
<span class="n">P_dash</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">P_dash</span><span class="p">)</span>
<span class="n">P_base</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">P</span>
</code></pre></div>
<p>It then calculates:</p>
<ul>
<li><code>phi</code>: the angle to rotate to face the marker</li>
<li><code>dist</code>: the forward distance to drive</li>
<li><code>z_rot_base</code>: a final rotation to align with robot gripper facing the marker</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">phi</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">base_position_y</span><span class="p">,</span> <span class="n">base_position_x</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">base_position_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">base_position_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">z_rot_base</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span> <span class="o">+</span> <span class="n">z_rot_base</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</code></pre></div>
<hr />
<h3 id="step-5-move-the-base">Step 5: Move the Base<a class="headerlink" href="#step-5-move-the-base" title="Anchor link">&para;</a></h3>
<p>The robot sends three sequential trajectory goals:</p>
<ol>
<li>Rotate toward the marker</li>
<li>Drive forward</li>
<li>Final rotation to align with marker axis</li>
</ol>
<p>Each goal is sent using the <code>rotate_mobile_base</code> or <code>translate_mobile_base</code> joints and executed <strong>synchronously</strong> using blocking calls:</p>
<div class="highlight"><pre><span></span><code><span class="n">send_base_goal_blocking</span><span class="p">(</span><span class="s2">&quot;rotate_mobile_base&quot;</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<span class="n">send_base_goal_blocking</span><span class="p">(</span><span class="s2">&quot;translate_mobile_base&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
<span class="n">send_base_goal_blocking</span><span class="p">(</span><span class="s2">&quot;rotate_mobile_base&quot;</span><span class="p">,</span> <span class="n">final_theta</span><span class="p">)</span>
</code></pre></div>
<p>Each goal is checked for acceptance and completion.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020-2025 Hello Robot Inc
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hello-robot.com" target="_blank" rel="noopener" title="hello-robot.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/HelloRobotInc" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/hello-robot" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/hello-robot-inc" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>