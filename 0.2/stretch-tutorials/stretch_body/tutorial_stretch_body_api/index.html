
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Hello Robot User Documentation">
      
      
        <meta name="author" content="Hello Robot Inc">
      
      
        <link rel="canonical" href="https://docs.hello-robot.com/0.2/stretch-tutorials/stretch_body/tutorial_stretch_body_api/">
      
      
        <link rel="prev" href="../tutorial_command_line_tools/">
      
      
        <link rel="next" href="../tutorial_robot_motion/">
      
      
      <link rel="icon" href="../../../images/hello_robot_favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Stretch Body API - Stretch Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="hello-robot-light" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stretch-body-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Stretch Documentation" class="md-header__button md-logo" aria-label="Stretch Documentation" data-md-component="logo">
      
  <img src="../../../images/hello_robot_logo_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stretch Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stretch Body API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="hello-robot-light" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="hello-robot-dark" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Stretch Documentation" class="md-nav__button md-logo" aria-label="Stretch Documentation" data-md-component="logo">
      
  <img src="../../../images/hello_robot_logo_light.png" alt="logo">

    </a>
    Stretch Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting to Know Stretch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Getting to Know Stretch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/safety_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Safety Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/quick_start_guide_re1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Stretch RE1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/quick_start_guide_re2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Stretch 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/best_practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/troubleshooting_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/command_line_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/untethered_operation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Untethered Operation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/updating_software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Software
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Body Python SDK
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Stretch Body Python SDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_command_line_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command line Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Stretch Body API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Stretch Body API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-robot-class" class="md-nav__link">
    <span class="md-ellipsis">
      The Robot Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.robot.Robot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_status()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.get_stow_pos" class="md-nav__link">
    <span class="md-ellipsis">
      get_stow_pos()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.is_calibrated" class="md-nav__link">
    <span class="md-ellipsis">
      is_calibrated()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.is_homed" class="md-nav__link">
    <span class="md-ellipsis">
      is_homed()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.push_command" class="md-nav__link">
    <span class="md-ellipsis">
      push_command()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.stow" class="md-nav__link">
    <span class="md-ellipsis">
      stow()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command" class="md-nav__link">
    <span class="md-ellipsis">
      wait_command()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wait_command()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-device-class" class="md-nav__link">
    <span class="md-ellipsis">
      The Device Class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Device Class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-arm-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Arm class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.arm.Arm" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.arm.Arm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.arm.Arm.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="home()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-lift-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Lift class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.lift.Lift" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.lift.Lift
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.lift.Lift.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="home()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-base-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Base class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.base.Base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.contact_thresh_to_motor_current" class="md-nav__link">
    <span class="md-ellipsis">
      contact_thresh_to_motor_current()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.enable_freewheel_mode" class="md-nav__link">
    <span class="md-ellipsis">
      enable_freewheel_mode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.enable_pos_incr_mode" class="md-nav__link">
    <span class="md-ellipsis">
      enable_pos_incr_mode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.follow_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      follow_trajectory()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="follow_trajectory()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.follow_trajectory--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.pull_status" class="md-nav__link">
    <span class="md-ellipsis">
      pull_status()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.pull_status_async" class="md-nav__link">
    <span class="md-ellipsis">
      pull_status_async()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.reset_odometry" class="md-nav__link">
    <span class="md-ellipsis">
      reset_odometry()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.rotate_by" class="md-nav__link">
    <span class="md-ellipsis">
      rotate_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_rotational_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_rotational_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_translate_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_translate_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.step_sentry" class="md-nav__link">
    <span class="md-ellipsis">
      step_sentry()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.stop_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      stop_trajectory()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.translate_by" class="md-nav__link">
    <span class="md-ellipsis">
      translate_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.update_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      update_trajectory()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_trajectory()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-head-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Head class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.head.Head
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_joint()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.move_by" class="md-nav__link">
    <span class="md-ellipsis">
      move_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.move_to" class="md-nav__link">
    <span class="md-ellipsis">
      move_to()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.pose" class="md-nav__link">
    <span class="md-ellipsis">
      pose()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-endofarm-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the EndOfArm class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.end_of_arm.EndOfArm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_joint()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint_configuration()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.is_tool_present" class="md-nav__link">
    <span class="md-ellipsis">
      is_tool_present()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.move_by" class="md-nav__link">
    <span class="md-ellipsis">
      move_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.move_to" class="md-nav__link">
    <span class="md-ellipsis">
      move_to()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.pose" class="md-nav__link">
    <span class="md-ellipsis">
      pose()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-wacc-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Wacc class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.wacc.Wacc" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.wacc.Wacc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.wacc.Wacc.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-pimu-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Pimu class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.pimu.Pimu" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.pimu.Pimu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.pimu.Pimu.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_robot_motion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Motion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_robot_sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Sensors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_dynamixel_servos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamixel Servos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_parameter_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameter Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_splined_trajectories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splined Trajectories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_collision_avoidance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collision Avoidance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_contact_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_tool_change/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changing Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_custom_wrist_dof/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Wrist DOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_safe_coding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Safety Features
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ROS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            ROS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/teleoperating_stretch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teleoperating Stretch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/internal_state_of_stretch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal State of Stretch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/rviz_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RViz Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/navigation_stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Navigation Stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/follow_joint_trajectory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Follow Joint Trajectory Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/perception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/aruco_marker_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArUco Marker Detection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/respeaker_microphone_array/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReSpeaker Microphone Array
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot/stretch_ros/tree/master/stretch_funmap" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUNMAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/gazebo_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gazebo Basics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3" id="__nav_2_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            Other Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teleoperate Stretch with a Node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter Laser Scans
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mobile Base Collision Avoidance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Give Stretch a Balloon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Print Joint States
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Store Effort Values
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capture Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voice to Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voice Teleoperation of Base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tf2 Broadcaster and Listener
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PointCloud Transformation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArUco Tag Locator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/example_13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2D Navigation Goals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros1/autodocking_nav_stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autodocking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ROS 2 (Beta)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            ROS 2 (Beta)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_2" >
        
          
          <label class="md-nav__link" for="__nav_2_5_2" id="__nav_2_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_2">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/follow_joint_trajectory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Follow Joint Trajectory Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/internal_state_of_stretch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal State of Stretch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/rviz_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RViz Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5_2_5" id="__nav_2_5_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nav2 Stack
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_5_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_2_5">
            <span class="md-nav__icon md-icon"></span>
            Nav2 Stack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/navigation_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/navigation_stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nav2 Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/navigation_simple_commander/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nav2 Simple Commander
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_5_3" id="__nav_2_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_3">
            <span class="md-nav__icon md-icon"></span>
            Other Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/example_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teleoperate Stretch with a Node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/example_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter Laser Scans
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/example_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mobile Base Collision Avoidance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/example_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Give Stretch a Balloon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/example_10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tf2 Broadcaster and Listener
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/obstacle_avoider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obstacle Avoider
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/align_to_aruco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Align to ArUco
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros2/deep_perception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deep Perception
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Tool Share
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Stretch Tool Share
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_2" >
        
          
          <label class="md-nav__link" for="__nav_2_6_2" id="__nav_2_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_2">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/gripper_removal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gripper Removal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/gripper_puller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gripper Puller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/dry_erase_holder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dry Erase Holder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/dexwrist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dex Wrist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/dex_to_standard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dex to Standard Wrist
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_3" >
        
          
          <label class="md-nav__link" for="__nav_2_6_3" id="__nav_2_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stretch_tool_share/updating_urdf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating URDF
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code Repositories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Code Repositories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../repos_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Body
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Stretch Body
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-body/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/stretch_body/tutorial_stretch_body_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/stretch_body/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-body/CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch ROS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Stretch ROS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/ros1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Packages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/hello_helpers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hello_helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_calibration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_calibration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_deep_perception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_deep_perception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_demos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_demos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_funmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_funmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_gazebo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_gazebo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_moveit_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_moveit_config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros/stretch_navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_navigation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch ROS2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Stretch ROS2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/ros2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Packages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/hello_helpers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hello_helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_calibration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_calibration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_deep_perception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_deep_perception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_demos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_demos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_funmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_funmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_gazebo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_gazebo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_moveit_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_moveit_config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_navigation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_octomap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_octomap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-ros2/stretch_rtabmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stretch_rtabmap
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Factory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Stretch Factory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Firmware
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Stretch Firmware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_2" >
        
          
          <label class="md-nav__link" for="__nav_3_6_2" id="__nav_3_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_updating_firmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_6_2_2" id="__nav_3_6_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integrating Custom Hardware
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_6_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_2_2">
            <span class="md-nav__icon md-icon"></span>
            Integrating Custom Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorials_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_data_transfer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Transfer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_i2c_sensor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I2C Sensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_spi_sensor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPI Sensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_serial_sensor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial Sensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-firmware/docs/tutorial_wacc_emulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wacc Emulaton
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Tool Share
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Stretch Tool Share
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_2" >
        
          
          <label class="md-nav__link" for="__nav_3_7_2" id="__nav_3_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7_2">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/dry_erase_holder_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dry Erase Holder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/phone_holder_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phone Holder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/puller_v1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Puller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/reactorx_wrist_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReactorX Wrist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/swiffer_mount_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swiffer Mount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/tray_cup_holder_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tray Cup Holder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/wrist_USB_board_camera/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wrist USB Camera
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/arm_mounted_tray_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arm Mounted Tray
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/card_holder_V1.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Card Holder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/stretch_dex_wrist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Dex Wrist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/stretch_docking_station/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Docking Station
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/stretch_RE1_arm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch RE1 Arm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/stretch_RE1_head/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch RE1 Head
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-tool-share/tool_share/stretch_teleop_kit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Teleop Kit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Install
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Stretch Install
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-install/docs/updating_software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Software
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-install/docs/add_new_user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding New Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-install/docs/ros_workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding a ROS Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-install/docs/robot_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Robot Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.1/dex_wrist_user_guide/#appendix-installation-and-configuration" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DexWrist Install
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch Web Interface
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Stretch Web Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-web-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hardware Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Hardware Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/getting_started/safety_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Safety Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch RE1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Stretch RE1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/battery_maintenance_guide_re1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battery Maintenance Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/hardware_guide_re1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/dex_wrist_guide_re1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DexWrist User Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stretch 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Stretch 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/battery_maintenance_guide_re2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battery Maintenance Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/hardware_guide_re2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stretch-hardware-guides/docs/dex_wrist_guide_re2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DexWrist User Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://forum.hello-robot.com/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Forum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hello-robot/stretch_community" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stretch Community
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-robot-class" class="md-nav__link">
    <span class="md-ellipsis">
      The Robot Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.robot.Robot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_status()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.get_stow_pos" class="md-nav__link">
    <span class="md-ellipsis">
      get_stow_pos()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.is_calibrated" class="md-nav__link">
    <span class="md-ellipsis">
      is_calibrated()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.is_homed" class="md-nav__link">
    <span class="md-ellipsis">
      is_homed()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.push_command" class="md-nav__link">
    <span class="md-ellipsis">
      push_command()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.stow" class="md-nav__link">
    <span class="md-ellipsis">
      stow()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command" class="md-nav__link">
    <span class="md-ellipsis">
      wait_command()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wait_command()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.robot.Robot.wait_command--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-device-class" class="md-nav__link">
    <span class="md-ellipsis">
      The Device Class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Device Class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-arm-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Arm class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.arm.Arm" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.arm.Arm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.arm.Arm.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="home()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-lift-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Lift class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.lift.Lift" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.lift.Lift
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.lift.Lift.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="home()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-base-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Base class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.base.Base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.contact_thresh_to_motor_current" class="md-nav__link">
    <span class="md-ellipsis">
      contact_thresh_to_motor_current()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.enable_freewheel_mode" class="md-nav__link">
    <span class="md-ellipsis">
      enable_freewheel_mode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.enable_pos_incr_mode" class="md-nav__link">
    <span class="md-ellipsis">
      enable_pos_incr_mode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.follow_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      follow_trajectory()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="follow_trajectory()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.follow_trajectory--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.pull_status" class="md-nav__link">
    <span class="md-ellipsis">
      pull_status()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.pull_status_async" class="md-nav__link">
    <span class="md-ellipsis">
      pull_status_async()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.reset_odometry" class="md-nav__link">
    <span class="md-ellipsis">
      reset_odometry()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.rotate_by" class="md-nav__link">
    <span class="md-ellipsis">
      rotate_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_rotational_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_rotational_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_translate_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_translate_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.base.Base.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.step_sentry" class="md-nav__link">
    <span class="md-ellipsis">
      step_sentry()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.stop_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      stop_trajectory()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.translate_by" class="md-nav__link">
    <span class="md-ellipsis">
      translate_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.base.Base.update_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      update_trajectory()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_trajectory()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-head-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Head class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.head.Head
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_joint()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.get_joint--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.move_by" class="md-nav__link">
    <span class="md-ellipsis">
      move_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.move_to" class="md-nav__link">
    <span class="md-ellipsis">
      move_to()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.pose" class="md-nav__link">
    <span class="md-ellipsis">
      pose()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.head.Head.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-endofarm-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the EndOfArm class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.end_of_arm.EndOfArm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_joint()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.get_joint_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      get_joint_configuration()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.home" class="md-nav__link">
    <span class="md-ellipsis">
      home()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.is_tool_present" class="md-nav__link">
    <span class="md-ellipsis">
      is_tool_present()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.move_by" class="md-nav__link">
    <span class="md-ellipsis">
      move_by()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.move_to" class="md-nav__link">
    <span class="md-ellipsis">
      move_to()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.pose" class="md-nav__link">
    <span class="md-ellipsis">
      pose()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.set_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      set_velocity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stretch_body.end_of_arm.EndOfArm.startup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-wacc-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Wacc class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.wacc.Wacc" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.wacc.Wacc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.wacc.Wacc.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="startup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-pimu-class" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Pimu class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.pimu.Pimu" class="md-nav__link">
    <span class="md-ellipsis">
      stretch_body.pimu.Pimu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stretch_body.pimu.Pimu.startup" class="md-nav__link">
    <span class="md-ellipsis">
      startup()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="stretch-body-api-reference">Stretch Body API Reference</h1>
<p>Stretch Body is the Python interface for working with Stretch. This page serves as a reference for the interfaces defined in the <code>stretch_body</code> library. 
See the <a href="https://docs.hello-robot.com/0.2/stretch-tutorials/stretch_body/">Stretch Body Tutorials</a> for additional information on working with this library.</p>
<h2 id="the-robot-class">The Robot Class</h2>
<p>The most common interface to Stretch is the <a href="#stretch_body.robot.Robot">Robot</a> class. This class encapsulates all devices on the robot. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.robot</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">Robot</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">startup</span><span class="p">():</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start robot!</span>

<span class="c1"># home the joints to find zero, if necessary</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">():</span>
    <span class="n">r</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

<span class="c1"># interact with the robot here</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.robot.Robot.startup"><code>startup()</code></a> and <a href="#stretch_body.robot.Robot.home"><code>home()</code></a> methods start communication with and home each of the robot's devices, respectively. Through the <a href="#stretch_body.robot.Robot">Robot</a> class, users can interact with all devices on the robot. For example, continuing the example above:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># moving joints on the robot</span>
<span class="n">r</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>

<span class="c1"># other devices on the robot</span>
<span class="n">r</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>

<span class="n">r</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Each of these devices is defined in separate modules within <code>stretch_body</code>. In the following section, we'll look at the API of these classes. The <a href="#stretch_body.robot.Robot.stop"><code>stop()</code></a> method shuts down communication with the robot's devices.</p>
<p>All methods in the <a href="#stretch_body.robot.Robot">Robot</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.robot.Robot"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Robot</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Robot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;robot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">RobotMonitor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">RobotTrace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span> <span class="o">=</span> <span class="n">RobotCollisionMgmt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty_push_command</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span> <span class="c1">#Prevent status thread from triggering motor sync prematurely</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pimu&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;lift&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;arm&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;head&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;wacc&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;end_of_arm&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">=</span><span class="n">pimu</span><span class="o">.</span><span class="n">Pimu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pimu&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">Base</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">=</span><span class="n">lift</span><span class="o">.</span><span class="n">Lift</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">=</span><span class="n">arm</span><span class="o">.</span><span class="n">Arm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;arm&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">=</span><span class="n">head</span><span class="o">.</span><span class="n">Head</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">status</span>

        <span class="k">if</span> <span class="s1">&#39;custom_wacc&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;custom_wacc&#39;</span><span class="p">][</span><span class="s1">&#39;py_module_name&#39;</span><span class="p">]</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;custom_wacc&#39;</span><span class="p">][</span><span class="s1">&#39;py_class_name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">),</span> <span class="n">class_name</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">=</span><span class="n">wacc</span><span class="o">.</span><span class="n">Wacc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;wacc&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eoa_name</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;tool&#39;</span><span class="p">]</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eoa_name</span><span class="p">][</span><span class="s1">&#39;py_module_name&#39;</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eoa_name</span><span class="p">][</span><span class="s1">&#39;py_class_name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">),</span> <span class="n">class_name</span><span class="p">)()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;end_of_arm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;pimu&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;lift&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="p">,</span> <span class="s1">&#39;arm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">,</span> <span class="s1">&#39;head&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;wacc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="p">,</span> <span class="s1">&#39;end_of_arm&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GLOBAL_EXCEPTIONS_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_excepthook</span>


    <span class="k">def</span> <span class="nf">custom_excepthook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">thread_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">name</span>
        <span class="n">Exec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Exec</span><span class="p">[</span><span class="n">thread_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;thread&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">thread</span><span class="p">,</span>
            <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">exc_type</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">exc_value</span><span class="p">,</span>
                <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">exc_traceback</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Filter RuntimeError</span>
        <span class="k">if</span> <span class="n">Exec</span><span class="p">[</span><span class="n">thread_name</span><span class="p">][</span><span class="s1">&#39;exception&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caught Exception in Thread: </span><span class="si">{</span><span class="n">thread_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">exc_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caught Exception in Thread: </span><span class="si">{</span><span class="n">thread_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">exc_value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GLOBAL_EXCEPTIONS_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Exec</span><span class="p">[</span><span class="n">thread_name</span><span class="p">])</span>

    <span class="c1"># ###########  Device Methods #############</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start_non_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">start_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">start_sys_mon_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To be called once after class instantiation.</span>
<span class="sd">        Prepares devices for communications and motion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            true if startup of robot succeeded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">did_acquire</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_lock</span> <span class="o">=</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">acquire_body_filelock</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">did_acquire</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Another process is already using Stretch. Try running &quot;stretch_free_robot_process.py&quot;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting up Robot </span><span class="si">{0}</span><span class="s1"> of batch </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;serial_no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;batch_name&#39;</span><span class="p">]))</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not able to use asyncio for transport communications. Defaulting to sync.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_event_loop</span><span class="p">()</span>

        <span class="c1">#Always startup to load URDFs now and not while thread is running</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_collision_manager&#39;</span><span class="p">]:</span> <span class="c1">#Turn it off here but allow user to enable it via SW later</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>

        <span class="c1"># Register the signal handlers</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">thread_service_shutdown</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">thread_service_shutdown</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span> <span class="o">=</span> <span class="n">NonDXLStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;NonDXLStatusThread_Hz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span> <span class="o">=</span> <span class="n">DXLEndOfArmStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;DXLStatusThread_Hz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span> <span class="o">=</span> <span class="n">SystemMonitorThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;SystemMonitorThread_Hz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span> <span class="o">=</span> <span class="n">DXLHeadStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;DXLStatusThread_Hz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span> <span class="o">=</span> <span class="n">CollisionMonitorThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_non_dxl_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">first_status</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_dxl_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start_sys_mon_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start_sys_mon_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">success</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To be called once before exiting a program</span>
<span class="sd">        Cleanly stops down motion and communication</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;---- Shutting down robot ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;---- Shutdown complete ----&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thread safe and atomic read of current Robot status data</span>
<span class="sd">        Returns as a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;##################### HELLO ROBOT ##################### &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Serial No&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;serial_no&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Batch&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;batch_name&#39;</span><span class="p">])</span>
        <span class="n">hello_utils</span><span class="o">.</span><span class="n">pretty_print_dict</span><span class="p">(</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_coro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">(),</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">(),</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">(),</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">(),</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">(),</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">push_command_async</span><span class="p">()]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cause all queued up RPC commands to be sent down to Devices</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">is_ready_for_sync</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_command_coro</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span><span class="p">)</span>
                <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

            <span class="c1"># Check if need to do a motor sync by looking at if there&#39;s been a pimu sync signal sent</span>
            <span class="c1"># since the last stepper.set_command for each joint</span>
            <span class="n">sync_required</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span> <span class="n">ready</span> <span class="ow">and</span> <span class="n">sync_required</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">trigger_motor_sync</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">enable_collision_mgmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">disable_collision_mgmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">wait_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pause program execution until all motion complete.</span>

<span class="sd">        Queuing up motion and pushing it to the hardware with</span>
<span class="sd">        push_command() is designed to be asynchronous, enabling</span>
<span class="sd">        reactive control of the robot. However, you might want</span>
<span class="sd">        sychronous control, where each command&#39;s motion is completed</span>
<span class="sd">        entirely before the program moves on to the next command.</span>
<span class="sd">        This is where you would use wait_command()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeout : float</span>
<span class="sd">            How long to wait for motion to complete. Must be &gt; 0.1 sec.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if motion completed, False if timed out before motion completed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">check_wait</span><span class="p">(</span><span class="n">wait_method</span><span class="p">):</span>
            <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wait_method</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
        <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

    <span class="c1"># ######### Waypoint Trajectory Interface ##############################</span>


    <span class="k">def</span> <span class="nf">is_trajectory_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">(</span><span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">(</span><span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">()</span>

        <span class="c1"># Check if need to do a motor sync by looking at if there&#39;s been a pimu sync signal sent</span>
        <span class="c1"># since the last stepper.set_command for each joint</span>
        <span class="n">sync_required</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sync_required</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">trigger_motor_sync</span><span class="p">()</span>

        <span class="n">success</span> <span class="o">=</span> <span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">(</span><span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">(</span><span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">success</span>

    <span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>

<span class="c1"># ##################Home and Stow #######################################</span>

    <span class="k">def</span> <span class="nf">is_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATED: replaced by Robot.is_homed()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;is_calibrated() has been replaced by is_homed()&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_homed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_homed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns true if homing has been run all joints that require it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="n">ready</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">is_calibrated</span>
            <span class="n">ready</span> <span class="o">=</span> <span class="n">ready</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">req</span>
        <span class="k">return</span> <span class="n">ready</span>

    <span class="k">def</span> <span class="nf">get_stow_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">joint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the stow position of a joint.</span>
<span class="sd">        Allow the end_of_arm to override the defaults in order to accomodate stowing different tools</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;stow&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="n">joint</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="n">joint</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">stow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cause the robot to move to its stow position</span>
<span class="sd">        Blocking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">))</span>

        <span class="n">lift_stowed</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">pos_lift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;lift&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">pos_lift</span><span class="p">:</span> <span class="c1">#Needs to come up before bring in arm</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Lift ----&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos_lift</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">4.0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">lift_stowed</span><span class="o">=</span><span class="kc">True</span>

        <span class="c1"># Run pre stow specific to each end of arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">pre_stow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#Bring in arm before bring down</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Arm ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;arm&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">6.0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">stow</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="c1">#Now bring lift down</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lift_stowed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Lift ----&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos_lift</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">12.0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="c1">#Make sure wrist yaw is done before exiting</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;wrist_yaw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cause the robot to home its joints by moving to hardstops</span>
<span class="sd">        Blocking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Head ----&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

        <span class="c1"># Wrist pitch should be angled somewhere in between the lift leaving</span>
        <span class="c1"># the base of its range and before it reaches the top of its range.</span>
        <span class="k">def</span> <span class="nf">_angle_pitch</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># wait 1 sec to leave bottom of lift&#39;s range</span>
            <span class="k">if</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;wrist_pitch&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

        <span class="c1"># If gripper present</span>
        <span class="k">if</span> <span class="s1">&#39;stretch_gripper&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span> <span class="ow">and</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_angle_pitch</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="s1">&#39;wrist_pitch&#39;</span><span class="p">],))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># No gripper but tablet or accessory present in dw3 wrist, wrist pitch should face downward</span>
        <span class="k">elif</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_angle_pitch</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.57</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Home the lift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Lift ----&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

        <span class="c1"># Home the arm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Arm ----&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

        <span class="c1"># Home the end-of-arm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>
        <span class="c1">#Let user know it is done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">trigger_beep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
    <span class="c1"># ################ Helpers #################################</span>

    <span class="k">def</span> <span class="nf">_pull_status_head_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SerialException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Serial Exception on Robot._pull_status_head_dynamixel&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_trajectory_head_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SerialException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Serial Exception on Robot._update_trajectory_head_dynamixel()&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_pull_status_end_of_arm_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SerialException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Serial Exception on Robot._pull_status_end_of_arm_dynamixel&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_trajectory_end_of_arm_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SerialException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Serial Exception on Robot._update_trajectory_end_of_arm_dynamixel()&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pull_status_non_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_trajectory_non_dynamixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AsyncEvenLoopThread&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span><span class="p">:</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_loop_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.get_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Thread safe and atomic read of current Robot status data
Returns as a dict.</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thread safe and atomic read of current Robot status data</span>
<span class="sd">    Returns as a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.get_stow_pos" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_stow_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Return the stow position of a joint.
Allow the end_of_arm to override the defaults in order to accomodate stowing different tools</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_stow_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">joint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the stow position of a joint.</span>
<span class="sd">    Allow the end_of_arm to override the defaults in order to accomodate stowing different tools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;stow&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="n">joint</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="n">joint</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.home" class="doc doc-heading">
<code class="highlight language-python"><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Cause the robot to home its joints by moving to hardstops
Blocking.</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cause the robot to home its joints by moving to hardstops</span>
<span class="sd">    Blocking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Head ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

    <span class="c1"># Wrist pitch should be angled somewhere in between the lift leaving</span>
    <span class="c1"># the base of its range and before it reaches the top of its range.</span>
    <span class="k">def</span> <span class="nf">_angle_pitch</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># wait 1 sec to leave bottom of lift&#39;s range</span>
        <span class="k">if</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;wrist_pitch&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

    <span class="c1"># If gripper present</span>
    <span class="k">if</span> <span class="s1">&#39;stretch_gripper&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span> <span class="ow">and</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_angle_pitch</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stow&#39;</span><span class="p">][</span><span class="s1">&#39;wrist_pitch&#39;</span><span class="p">],))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># No gripper but tablet or accessory present in dw3 wrist, wrist pitch should face downward</span>
    <span class="k">elif</span> <span class="s1">&#39;wrist_pitch&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_angle_pitch</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.57</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Home the lift</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Lift ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

    <span class="c1"># Home the arm</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing Arm ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

    <span class="c1"># Home the end-of-arm</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>
    <span class="c1">#Let user know it is done</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">trigger_beep</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.is_calibrated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>DEPRECATED: replaced by Robot.is_homed()</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRECATED: replaced by Robot.is_homed()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;is_calibrated() has been replaced by is_homed()&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_homed</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.is_homed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_homed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns true if homing has been run all joints that require it</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_homed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns true if homing has been run all joints that require it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span>
    <span class="n">ready</span> <span class="o">=</span> <span class="n">ready</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">is_calibrated</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="n">ready</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">req</span>
    <span class="k">return</span> <span class="n">ready</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.push_command" class="doc doc-heading">
<code class="highlight language-python"><span class="n">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Cause all queued up RPC commands to be sent down to Devices</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cause all queued up RPC commands to be sent down to Devices</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">is_ready_for_sync</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_command_coro</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">async_event_loop</span><span class="p">)</span>
            <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

        <span class="c1"># Check if need to do a motor sync by looking at if there&#39;s been a pimu sync signal sent</span>
        <span class="c1"># since the last stepper.set_command for each joint</span>
        <span class="n">sync_required</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">ts_last_motor_sync</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span> <span class="n">ready</span> <span class="ow">and</span> <span class="n">sync_required</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">trigger_motor_sync</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_non_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_sys_mon_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>To be called once after class instantiation.
Prepares devices for communications and motion</p>
<h4 id="stretch_body.robot.Robot.startup--returns">Returns</h4>
<p>bool
    true if startup of robot succeeded</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start_non_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">start_dxl_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">start_sys_mon_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To be called once after class instantiation.</span>
<span class="sd">    Prepares devices for communications and motion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        true if startup of robot succeeded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">did_acquire</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_lock</span> <span class="o">=</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">acquire_body_filelock</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">did_acquire</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Another process is already using Stretch. Try running &quot;stretch_free_robot_process.py&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting up Robot </span><span class="si">{0}</span><span class="s1"> of batch </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;serial_no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;batch_name&#39;</span><span class="p">]))</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not able to use asyncio for transport communications. Defaulting to sync.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_asyncio&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_event_loop</span><span class="p">()</span>

    <span class="c1">#Always startup to load URDFs now and not while thread is running</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_collision_manager&#39;</span><span class="p">]:</span> <span class="c1">#Turn it off here but allow user to enable it via SW later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>

    <span class="c1"># Register the signal handlers</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">thread_service_shutdown</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">hello_utils</span><span class="o">.</span><span class="n">thread_service_shutdown</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span> <span class="o">=</span> <span class="n">NonDXLStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;NonDXLStatusThread_Hz&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span> <span class="o">=</span> <span class="n">DXLEndOfArmStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;DXLStatusThread_Hz&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span> <span class="o">=</span> <span class="n">SystemMonitorThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;SystemMonitorThread_Hz&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span> <span class="o">=</span> <span class="n">DXLHeadStatusThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="s1">&#39;DXLStatusThread_Hz&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span> <span class="o">=</span> <span class="n">CollisionMonitorThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_rate_hz</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start_non_dxl_thread</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">first_status</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start_dxl_thread</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_sys_mon_thread</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_sys_mon_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">success</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.stop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>To be called once before exiting a program
Cleanly stops down motion and communication</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To be called once before exiting a program</span>
<span class="sd">    Cleanly stops down motion and communication</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;---- Shutting down robot ----&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_dxl_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_head_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl_end_of_arm_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">shutdown_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_mgmt_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_event_loop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;---- Shutdown complete ----&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.stow" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Cause the robot to move to its stow position
Blocking.</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cause the robot to move to its stow position</span>
<span class="sd">    Blocking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disable_collision_mgmt</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">))</span>

    <span class="n">lift_stowed</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">pos_lift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;lift&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">pos_lift</span><span class="p">:</span> <span class="c1">#Needs to come up before bring in arm</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Lift ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos_lift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">lift_stowed</span><span class="o">=</span><span class="kc">True</span>

    <span class="c1"># Run pre stow specific to each end of arm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">pre_stow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#Bring in arm before bring down</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Arm ----&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stow_pos</span><span class="p">(</span><span class="s1">&#39;arm&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">6.0</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">stow</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

    <span class="c1">#Now bring lift down</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lift_stowed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Stowing Lift ----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos_lift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">12.0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1">#Make sure wrist yaw is done before exiting</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;wrist_yaw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_collision_mgmt</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.robot.Robot.wait_command" class="doc doc-heading">
<code class="highlight language-python"><span class="n">wait_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Pause program execution until all motion complete.</p>
<p>Queuing up motion and pushing it to the hardware with
push_command() is designed to be asynchronous, enabling
reactive control of the robot. However, you might want
sychronous control, where each command's motion is completed
entirely before the program moves on to the next command.
This is where you would use wait_command()</p>
<h4 id="stretch_body.robot.Robot.wait_command--parameters">Parameters</h4>
<p>timeout : float
    How long to wait for motion to complete. Must be &gt; 0.1 sec.</p>
<h4 id="stretch_body.robot.Robot.wait_command--returns">Returns</h4>
<p>bool
    True if motion completed, False if timed out before motion completed</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/robot.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">wait_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pause program execution until all motion complete.</span>

<span class="sd">    Queuing up motion and pushing it to the hardware with</span>
<span class="sd">    push_command() is designed to be asynchronous, enabling</span>
<span class="sd">    reactive control of the robot. However, you might want</span>
<span class="sd">    sychronous control, where each command&#39;s motion is completed</span>
<span class="sd">    entirely before the program moves on to the next command.</span>
<span class="sd">    This is where you would use wait_command()</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    timeout : float</span>
<span class="sd">        How long to wait for motion to complete. Must be &gt; 0.1 sec.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if motion completed, False if timed out before motion completed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">check_wait</span><span class="p">(</span><span class="n">wait_method</span><span class="p">):</span>
        <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wait_method</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="the-device-class">The Device Class</h2>
<p>The <code>stretch_body</code> library is modular in design. Each subcomponent of Stretch is defined in its class and the <a href="#the-robot-class">Robot class</a> provides an interface that ties all of these classes together. This modularity allows users to plug in new/modified subcomponents into the <a href="#stretch_body.robot.Robot">Robot</a> interface by extending the Device class.</p>
<p>It is possible to interface with a single subcomponent of Stretch by initializing its device class directly. In this section, we'll look at the API of seven subclasses of the Device class: the <a href="#stretch_body.arm.Arm">Arm</a>, <a href="#stretch_body.lift.Lift">Lift</a>, <a href="#stretch_body.base.Base">Base</a>, <a href="#stretch_body.head.Head">Head</a>, <a href="#stretch_body.end_of_arm.EndOfArm">EndOfArm</a>, <a href="#stretch_body.wacc.Wacc">Wacc</a>, and <a href="#stretch_body.pimu.Pimu">Pimu</a> subcomponents of Stretch.</p>
<h3 id="using-the-arm-class">Using the Arm class</h3>
<p><img alt="Top down Stretch arm blueprint" src="../images/arm_top.png#only-light" />
<img alt="Top down Stretch arm blueprint" src="../images/arm_top.png#only-dark" /></p>
<p>The interface to Stretch's telescoping arm is the <a href="#stretch_body.arm.Arm">Arm</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.arm</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">Arm</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_sync_mode</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">startup</span><span class="p">():</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start arm!</span>

<span class="n">a</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

<span class="c1"># interact with the arm here</span>
</code></pre></div></td></tr></table></div>
<p>Since both <a href="#stretch_body.arm.Arm">Arm</a> and <a href="#stretch_body.robot.Robot">Robot</a> are subclasses of the <a href="#stretch_body.device.Device">Device</a> class, the same <a href="#stretch_body.arm.Arm.startup"><code>startup()</code></a> and <a href="#stretch_body.arm.Arm.stop"><code>stop()</code></a> methods are available here, as well as other <a href="#stretch_body.device.Device">Device</a> methods such as <a href="#stretch_body.arm.Arm.home"><code>home()</code></a>. Using the <a href="#stretch_body.arm.Arm">Arm</a> class, we can read the arm's current state and send commands to the joint. For example, continuing the example above:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">starting_position</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

<span class="c1"># move out by 10cm</span>
<span class="n">a</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">starting_position</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>

<span class="c1"># move back to starting position quickly</span>
<span class="n">a</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">starting_position</span><span class="p">,</span> <span class="n">v_m</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>

<span class="n">a</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># move out by 10cm</span>
<span class="n">a</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.arm.Arm.move_to"><code>move_to()</code></a> and <a href="#stretch_body.arm.Arm.move_by"><code>move_by()</code></a> methods queue absolute and relative position commands to the arm, respectively, while the nonblocking <a href="#stretch_body.arm.Arm.push_command"><code>push_command()</code></a> method pushes the queued position commands to the hardware for execution.</p>
<p>The attribute <code>motor</code>, an instance of the <a href="#stretch_body.stepper.Stepper">Stepper</a> class, has the method <a href="#stretch_body.stepper.Stepper.wait_until_at_setpoint"><code>wait_until_at_setpoint()</code></a> which blocks program execution until the joint reaches the commanded goal. With <a href="https://github.com/hello-robot/stretch_firmware/blob/master/tutorials/docs/updating_firmware.md">firmware P1 or greater</a> installed, it is also possible to queue a waypoint trajectory for the arm to follow:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">starting_position</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

<span class="c1"># queue a trajectory consisting of four waypoints</span>
<span class="n">a</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="n">starting_position</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># trigger trajectory execution</span>
<span class="n">a</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The attribute <code>trajectory</code>, an instance of the <a href="#stretch_body.trajectories.PrismaticTrajectory">PrismaticTrajectory</a> class, has the method <a href="#stretch_body.trajectories.PrismaticTrajectory.add"><code>add()</code></a> which adds a single waypoint in a linear sliding trajectory. For a well-formed <code>trajectory</code> (see <a href="#stretch_body.trajectories.Spline.is_valid"><code>is_valid()</code></a>), the <a href="#stretch_body.arm.Arm.follow_trajectory"><code>follow_trajectory()</code></a> method starts tracking the trajectory for the telescoping arm.</p>
<p>It is also possible to dynamically restrict the arm joint range:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">range_upper_limit</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># meters</span>

<span class="c1"># set soft limits on arm&#39;s range</span>
<span class="n">a</span><span class="o">.</span><span class="n">set_soft_motion_limit_min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set_soft_motion_limit_max</span><span class="p">(</span><span class="n">range_upper_limit</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

<span class="c1"># command the arm outside the valid range</span>
<span class="n">a</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span> <span class="c1"># we should expect to see ~0.3</span>

<span class="n">a</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.arm.Arm.set_soft_motion_limit_min"><code>set_soft_motion_limit_min/max()</code></a> methods form the basis of an experimental <a href="https://github.com/hello-robot/stretch_body/blob/master/body/stretch_body/robot_collision.py#L47">self-collision avoidance</a> system built into Stretch Body.</p>
<p>All methods in the <a href="#stretch_body.arm.Arm">Arm class</a> are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.arm.Arm"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Arm</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Arm</span><span class="p">(</span><span class="n">PrismaticJoint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Arm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">PrismaticJoint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;arm&#39;</span><span class="p">,</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span><span class="p">)</span>

    <span class="c1"># ######### Utilties ##############################</span>

    <span class="k">def</span> <span class="nf">motor_rad_to_translate_m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ang</span><span class="p">):</span> <span class="c1">#input in rad, output m</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;chain_pitch&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;chain_sprocket_teeth&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr_spur&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">ang</span>

    <span class="k">def</span> <span class="nf">translate_m_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;chain_pitch&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;chain_sprocket_teeth&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr_spur&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PrismaticJoint</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">end_pos</span><span class="o">=</span><span class="n">end_pos</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="n">to_positive_stop</span><span class="p">,</span><span class="n">measuring</span><span class="o">=</span><span class="n">measuring</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.arm.Arm.home" class="doc doc-heading">
<code class="highlight language-python"><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>end_pos: position to end on
to_positive_stop:
-- True: Move to the positive direction stop and mark to range_m[1]
-- False: Move to the negative direction stop and mark to range_m[0]
measuring: After homing to stop, move to opposite stop and report back measured distance
return measured range-of-motion if measuring. Return None if not a valide measurement</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PrismaticJoint</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">end_pos</span><span class="o">=</span><span class="n">end_pos</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="n">to_positive_stop</span><span class="p">,</span><span class="n">measuring</span><span class="o">=</span><span class="n">measuring</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>

<h3 id="using-the-lift-class">Using the Lift class</h3>
<p><img alt="Stretch lift blueprint" src="../images/lift_detail_rs.png#only-light" />
<img alt="Stretch lift blueprint" src="../images/lift_detail_rs.png#only-dark" /></p>
<p>The interface to Stretch's lift is the <a href="#stretch_body.lift.Lift">Lift</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.lift</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">Lift</span><span class="p">()</span>
<span class="n">l</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_sync_mode</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startup</span><span class="p">():</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start lift!</span>

<span class="n">l</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

<span class="c1"># interact with the lift here</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.lift.Lift.startup"><code>startup()</code></a> and <a href="#stretch_body.lift.Lift.home"><code>home()</code></a> methods are extended from the <a href="#stretch_body.device.Device">Device</a> class. Reading the lift's current state and sending commands to the joint occurs similarly to the <a href="#stretch_body.arm.Arm">Arm</a> class:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">starting_position</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

<span class="c1"># move up by 10cm</span>
<span class="n">l</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">starting_position</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">l</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The attribute <code>status</code> is a dictionary of the joint's current status. This state information is updated in the background in real-time by default (disable by initializing as <a href="#stretch_body.lift.Lift.startup"><code>startup(threading=False)</code></a>). Use the <a href="#stretch_body.lift.Lift.pretty_print"><code>pretty_print()</code></a> method to print out this state info in a human-interpretable format. Setting up waypoint trajectories for the lift is also similar to the <a href="#stretch_body.arm.Arm">Arm</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">starting_position</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

<span class="c1"># queue a trajectory consisting of three waypoints</span>
<span class="n">l</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="n">starting_position</span><span class="p">,</span> <span class="n">v_m</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>               <span class="n">v_m</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x_m</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>               <span class="n">v_m</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># trigger trajectory execution</span>
<span class="n">l</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The attribute <code>trajectory</code> is also an instance of the <a href="#stretch_body.trajectories.PrismaticTrajectory">PrismaticTrajectory</a> class, and by providing the instantaneous velocity argument <code>v_m</code> to the <a href="#stretch_body.trajectories.PrismaticTrajectory.add"><code>add()</code></a> method, a cubic spline can be loaded into the joint's <code>trajectory</code>. The call to <a href="#stretch_body.lift.Lift.follow_trajectory"><code>follow_trajectory()</code></a> begins hardware tracking of the spline.</p>
<p>Finally, setting soft motion limits for the lift's range can be done using:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># cut out 0.2m from the top and bottom of the lift&#39;s range</span>
<span class="n">l</span><span class="o">.</span><span class="n">set_soft_motion_limit_min</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">set_soft_motion_limit_max</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

<span class="n">l</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.lift.Lift.set_soft_motion_limit_min"><code>set_soft_motion_limit_min/max()</code></a> methods perform clipping of the joint's range at the firmware level (can persist across reboots).</p>
<p>All methods in the <a href="#stretch_body.lift.Lift">Lift</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.lift.Lift"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Lift</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/lift.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Lift</span><span class="p">(</span><span class="n">PrismaticJoint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Lift</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">PrismaticJoint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lift&#39;</span><span class="p">,</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span><span class="p">)</span>

    <span class="c1"># ######### Utilties ##############################</span>

    <span class="k">def</span> <span class="nf">motor_rad_to_translate_m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ang</span><span class="p">):</span> <span class="c1">#input in rad</span>
        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pinion_t&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;belt_pitch_m&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">lift_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lift_m</span>

    <span class="k">def</span> <span class="nf">translate_m_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pinion_t&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;belt_pitch_m&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="mi">180</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">((</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PrismaticJoint</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">end_pos</span><span class="o">=</span><span class="n">end_pos</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="n">to_positive_stop</span><span class="p">,</span><span class="n">measuring</span><span class="o">=</span><span class="n">measuring</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.lift.Lift.home" class="doc doc-heading">
<code class="highlight language-python"><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>end_pos: position to end on
to_positive_stop:
-- True: Move to the positive direction stop and mark to range_m[1]
-- False: Move to the negative direction stop and mark to range_m[0]
measuring: After homing to stop, move to opposite stop and report back measured distance
return measured range-of-motion if measuring. Return None if not a valide measurement</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/lift.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_pos</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">measuring</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PrismaticJoint</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">end_pos</span><span class="o">=</span><span class="n">end_pos</span><span class="p">,</span><span class="n">to_positive_stop</span><span class="o">=</span><span class="n">to_positive_stop</span><span class="p">,</span><span class="n">measuring</span><span class="o">=</span><span class="n">measuring</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>

<h3 id="using-the-base-class">Using the Base class</h3>
<p><img alt="Stretch mobile base diagram" src="../images/hw_image_1.png#only-light" />
<img alt="Stretch mobile base diagram" src="../images/hw_image_1.png#only-dark" /></p>
<table>
<thead>
<tr>
<th></th>
<th>Item</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Drive wheels</td>
<td>4 inch diameter, urethane rubber shore 60A</td>
</tr>
<tr>
<td>B</td>
<td>Cliff sensors</td>
<td>Sharp GP2Y0A51SK0F, Analog, range 2-15 cm</td>
</tr>
<tr>
<td>C</td>
<td>Mecanum wheel</td>
<td>Diameter 50mm</td>
</tr>
</tbody>
</table>
<p>The interface to Stretch's mobile base is the <a href="#stretch_body.base.Base">Base</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.base</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Base</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">disable_sync_mode</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">disable_sync_mode</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">startup</span><span class="p">():</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start base!</span>

<span class="c1"># interact with the base here</span>
</code></pre></div></td></tr></table></div>
<p>Stretch's mobile base is a differential drive configuration. The left and right wheels are accessible through <a href="#stretch_body.base.Base">Base</a> <code>left_wheel</code> and  <code>right_wheel</code> attributes, both of which are instances of the <a href="#stretch_body.stepper.Stepper">Stepper</a> class. The <a href="#stretch_body.base.Base.startup"><code>startup()</code></a> method is extended from the <a href="#stretch_body.device.Device">Device</a> class. Since the mobile base is unconstrained, there is no homing method. The <a href="#stretch_body.base.Base.pretty_print"><code>pretty_print()</code></a> method prints out mobile base state information in a human-interpretable format. We can read the base's current state and send commands using:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">b</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>

<span class="c1"># translate forward by 10cm</span>
<span class="n">b</span><span class="o">.</span><span class="n">translate_by</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>

<span class="c1"># rotate counter-clockwise by 90 degrees</span>
<span class="n">b</span><span class="o">.</span><span class="n">rotate_by</span><span class="p">(</span><span class="mf">1.57</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.base.Base.translate_by"><code>translate_by()</code></a> and <a href="#stretch_body.base.Base.rotate_by"><code>rotate_by()</code></a> methods send relative commands similar to the way <a href="#stretch_body.lift.Lift.move_by"><code>move_by()</code></a> behaves for the single degree of freedom joints.</p>
<p>The mobile base also supports velocity control:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># command the base to translate forward at 5cm / second</span>
<span class="n">b</span><span class="o">.</span><span class="n">set_translate_velocity</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># command the base to rotate counter-clockwise at 0.1rad / second</span>
<span class="n">b</span><span class="o">.</span><span class="n">set_rotational_velocity</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># command the base with translational and rotational velocities</span>
<span class="n">b</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># stop base motion</span>
<span class="n">b</span><span class="o">.</span><span class="n">enable_freewheel_mode</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.base.Base.set_translate_velocity"><code>set_translate_velocity()</code></a> and <a href="#stretch_body.base.Base.set_rotational_velocity"><code>set_rotational_velocity()</code></a> methods give velocity control over the translational and rotational components of the mobile base independently. The <a href="#stretch_body.base.Base.set_velocity"><code>set_velocity()</code></a> method gives control over both of these components simultaneously.</p>
<p>To halt motion, you can command zero velocities or command the base into freewheel mode using <a href="#stretch_body.base.Base.enable_freewheel_mode"><code>enable_freewheel_mode()</code></a>. The mobile base also supports waypoint trajectory following, but the waypoints are part of the SE2 group, where a desired waypoint is defined as an (x, y) point and a theta orientation:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># reset odometry calculation</span>
<span class="n">b</span><span class="o">.</span><span class="n">first_step</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">b</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>

<span class="c1"># queue a trajectory consisting of three waypoints</span>
<span class="n">b</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># trigger trajectory execution</span>
<span class="n">b</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])</span> <span class="c1"># we should expect to see around (0.0, 0.0, 0.0 or 6.28)</span>

<span class="n">b</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <a href="#stretch_body.base.Base">Base</a> waypoint trajectory following has no notion of obstacles in the environment. It will blindly follow the commanded waypoints. For obstacle avoidance, we recommend employing perception and a path planner.</p>
</div>
<p>The attribute <code>trajectory</code> is an instance of the <a href="#stretch_body.trajectories.DiffDriveTrajectory">DiffDriveTrajectory</a> class. The call to <a href="#stretch_body.base.Base.follow_trajectory"><code>follow_trajectory()</code></a> begins hardware tracking of the spline.</p>
<p>All methods of the <a href="#stretch_body.base.Base">Base</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.base.Base"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Mobile Base</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Mobile Base</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usb_right</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">usb_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">usb_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;usb_name_left_wheel&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">usb_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">usb_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;usb_name_right_wheel&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span> <span class="o">=</span> <span class="n">Stepper</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="n">usb_left</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello-motor-left-wheel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span> <span class="o">=</span> <span class="n">Stepper</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="n">usb_right</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello-motor-right-wheel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;theta&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x_vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y_vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;theta_vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pose_time_s&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;left_wheel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;right_wheel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;translation_force&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rotation_torque&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">DiffDriveTrajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_rate_hz</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_step</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">wheel_circumference_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_diameter_m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meters_per_motor_rad</span> <span class="o">=</span> <span class="p">(</span><span class="n">wheel_circumference_m</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wheel_separation_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]</span>

        <span class="c1"># Default controller params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel_mr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># ###########  Device Methods #############</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">#Startup steppers first so that status is populated before this Device thread begins (if threaded==true)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">success</span>

    <span class="k">def</span> <span class="nf">_thread_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------Base------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X (m)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y (m)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Theta (rad)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_vel (m/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x_vel&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y_vel (m/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y_vel&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Theta_vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta_vel&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pose time (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pose_time_s&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp PC (s):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----Left-Wheel-----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----Right-Wheel-----&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>

    <span class="c1"># ###################################################</span>
    <span class="k">def</span> <span class="nf">enable_freewheel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force motors into freewheel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_freewheel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_freewheel</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">enable_pos_incr_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Force motors into incremental position mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_pos_traj_incr</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_pos_traj_incr</span><span class="p">()</span>

    <span class="c1"># ###################################################</span>

    <span class="k">def</span> <span class="nf">wait_for_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">use_motion_generator</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">check_wait</span><span class="p">(</span><span class="n">wait_method</span><span class="p">):</span>
            <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wait_method</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span><span class="n">use_motion_generator</span><span class="p">))</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">wait_while_is_moving</span><span class="p">,)))</span>
        <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
        <span class="c1">#Assume both are in motion. This will exit once both are at setpoints</span>
        <span class="n">at_setpoint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">check_wait</span><span class="p">(</span><span class="n">wait_method</span><span class="p">):</span>
            <span class="n">at_setpoint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wait_method</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">check_wait</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">,)))</span>
        <span class="p">[</span><span class="n">done_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">done_thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="p">[</span><span class="n">done_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">done_thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">at_setpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contact_thresh_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">is_translate</span><span class="p">,</span><span class="n">contact_thresh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This model converts from a specified percentage effort (-100 to 100) of translate/rotational effort to motor currents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_translate</span><span class="p">:</span>
            <span class="n">e_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_translate_default&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">contact_thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">contact_thresh</span>
            <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_translate_max&#39;</span><span class="p">]</span>
            <span class="n">i_l</span><span class="p">,</span> <span class="n">i_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation_effort_pct_to_motor_current</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">e_c</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_rotate_default&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">contact_thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">contact_thresh</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_rotate_max&#39;</span><span class="p">]</span>
            <span class="n">i_l</span><span class="p">,</span> <span class="n">i_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_effort_pct_to_motor_current</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">e_c</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">m</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">i_l</span><span class="p">,</span><span class="n">i_r</span>

    <span class="k">def</span> <span class="nf">translate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">v_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Incremental translation of the base</span>
<span class="sd">        x_m: desired motion (m)</span>
<span class="sd">        v_m: velocity for trapezoidal motion profile (m/s)</span>
<span class="sd">        a_m: acceleration for trapezoidal motion profile (m/s^2)</span>
<span class="sd">        stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;translate_by&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

        <span class="n">x_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">x_m</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
            <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_mr</span>

        <span class="k">if</span> <span class="n">a_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
            <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_vel_m&#39;</span><span class="p">]),</span><span class="n">v_mr</span><span class="p">)</span>
            <span class="n">a_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_accel_m&#39;</span><span class="p">]),</span><span class="n">a_mr</span><span class="p">)</span>

        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                    <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                    <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">i_contact_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                    <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                    <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">i_contact_r</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">rotate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Incremental rotation of the base</span>
<span class="sd">        x_r: desired motion (radians)</span>
<span class="sd">        v_r: velocity for trapezoidal motion profile (rad/s)</span>
<span class="sd">        a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;rotate_by&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

        <span class="n">x_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">x_r</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
            <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
            <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_mr</span><span class="p">),</span><span class="n">v_mr_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_mr</span>

        <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">a_r</span><span class="p">)</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_mr</span><span class="p">),</span> <span class="n">a_mr_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
            <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_vel_m&#39;</span><span class="p">]),</span><span class="n">v_mr</span><span class="p">)</span>
            <span class="n">a_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_accel_m&#39;</span><span class="p">]),</span><span class="n">a_mr</span><span class="p">)</span>


        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span><span class="n">x_des</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">x_mr</span><span class="p">,</span>
                                    <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                    <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span><span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                     <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                     <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                     <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                     <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                     <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">set_translate_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command the bases translational velocity.</span>
<span class="sd">        Use care to prevent collisions / avoid runaways</span>
<span class="sd">        v_m: desired velocity (m/s)</span>
<span class="sd">        a_m: acceleration of motion profile (m/s^2)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_translate_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>
        <span class="n">v_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
        <span class="n">v_m</span> <span class="o">=</span> <span class="n">v_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                     <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                     <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                     <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_rotational_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command the bases rotational velocity.</span>
<span class="sd">        Use care to prevent collisions / avoid runaways</span>
<span class="sd">        v_r: desired rotational velocity (rad/s)</span>
<span class="sd">        a_r: acceleration of motion profile (rad/s^2)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_rotational_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_mr_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">a_r</span><span class="p">)</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_mr</span><span class="p">),</span> <span class="n">a_mr_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

        <span class="n">w_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
        <span class="n">v_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="n">w_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_mr</span><span class="p">),</span> <span class="n">v_mr_max</span><span class="p">)</span>
        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                     <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                     <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                     <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">w_r</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command the bases translational and rotational</span>
<span class="sd">        velocities simultaneously.</span>
<span class="sd">        Use care to prevent collisions / avoid runaways</span>
<span class="sd">        v_m: desired velocity (m/s)</span>
<span class="sd">        w_r: desired rotational velocity (rad/s)</span>
<span class="sd">        a:   acceleration of motion profile (m/s^2 and rad/s^2)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

        <span class="c1"># Unicycle dynamics w/o R because</span>
        <span class="c1"># translate_to_motor_rad accounts for R and gear ratio</span>
        <span class="n">wl_m</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">w_r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wr_m</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">wl_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">wl_m</span><span class="p">)</span>
        <span class="n">wl_m</span> <span class="o">=</span> <span class="n">wl_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wl_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">wl_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">wl_m</span><span class="p">)</span>

        <span class="n">wr_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">wr_m</span><span class="p">)</span>
        <span class="n">wr_m</span> <span class="o">=</span> <span class="n">wr_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wr_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">wr_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">wr_m</span><span class="p">)</span>

        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>

        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                        <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_vel_traj&#39;</span><span class="p">]:</span>
            <span class="n">ctrl_mode</span> <span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctrl_mode</span> <span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_PID</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ctrl_mode</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">wl_r</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                    <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ctrl_mode</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">wr_r</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                     <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                     <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                     <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>

    <span class="c1"># ######### Waypoint Trajectory Interface ##############################</span>
    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts executing a waypoint trajectory</span>

<span class="sd">        `self.trajectory` must be populated with a valid trajectory before calling</span>
<span class="sd">        this method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v_r : float</span>
<span class="sd">            velocity limit for trajectory in motor space in meters per second</span>
<span class="sd">        a_r : float</span>
<span class="sd">            acceleration limit for trajectory in motor space in meters per second squared</span>
<span class="sd">        stiffness : float</span>
<span class="sd">            stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">        contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">        contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;follow_trajectory&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

        <span class="c1"># check if joint valid, traj active, and right protocol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base connection to hardware not valid&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base waypoint trajectory already active&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Base left motor firmware version doesn&#39;t support waypoint trajectories&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Base right motor firmware version doesn&#39;t support waypoint trajectories&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># check if trajectory valid</span>
        <span class="n">vel_limit</span> <span class="o">=</span> <span class="n">v_r</span> <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
        <span class="n">acc_limit</span> <span class="o">=</span> <span class="n">a_r</span> <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
        <span class="n">valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">vel_limit</span><span class="p">,</span> <span class="n">acc_limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base trajectory not valid: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;must have at least two waypoints&quot;</span><span class="p">:</span>
            <span class="c1"># skip this device</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># set defaults</span>
        <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]))</span> \
            <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]))</span> \
            <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">])</span>

        <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

        <span class="c1"># start trajectory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">,</span>
                                    <span class="n">v_des</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                                    <span class="n">a_des</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                    <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                    <span class="n">i_contact_neg</span><span class="o">=-</span><span class="n">i_contact_l</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">,</span>
                                     <span class="n">v_des</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                                     <span class="n">a_des</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                     <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                     <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                     <span class="n">i_contact_neg</span><span class="o">=-</span><span class="n">i_contact_r</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">ls0</span><span class="p">,</span> <span class="n">rs0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_wheel_segments</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">start_waypoint_trajectory</span><span class="p">(</span><span class="n">ls0</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">start_waypoint_trajectory</span><span class="p">(</span><span class="n">rs0</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">reset_odometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset X/Y/Theta to report 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_step</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_trajectory_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_trajectory_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Return trajectory execution time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_trajectory_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_ts</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates hardware with the next segment of `self.trajectory`</span>

<span class="sd">        This method must be called frequently to enable complete trajectory execution</span>
<span class="sd">        and preemption of future segments. If used with `stretch_body.robot.Robot` or</span>
<span class="sd">        with `self.startup(threaded=True)`, a background thread is launched for this.</span>
<span class="sd">        Otherwise, the user must handle calling this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if joint valid, right protocol, and right mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span>
            <span class="n">next_segment_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># subtract 2 due to IDs 0 &amp; 1 being reserved by firmware</span>
            <span class="k">if</span> <span class="n">next_segment_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">():</span>
                <span class="n">ls1</span><span class="p">,</span> <span class="n">rs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_wheel_segments</span><span class="p">(</span><span class="n">next_segment_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_next_trajectory_segment</span><span class="p">(</span><span class="n">ls1</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_next_trajectory_segment</span><span class="p">(</span><span class="n">rs1</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idle&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idle&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_pos_traj</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_pos_traj</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop waypoint trajectory immediately and resets hardware</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">robot</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only allow fast mobile base motion if the lift is low,</span>
<span class="sd">        the arm is retracted, and the wrist is stowed. This is</span>
<span class="sd">        intended to keep the center of mass low for increased</span>
<span class="sd">        stability and avoid catching the arm or tool on</span>
<span class="sd">        something.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;base_max_velocity&#39;</span><span class="p">]:</span>
            <span class="n">x_lift</span><span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
            <span class="n">x_arm</span> <span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
            <span class="n">x_wrist</span> <span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;wrist_yaw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">x_lift</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;max_lift_height_m&#39;</span><span class="p">])</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">x_arm</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;max_arm_extension_m&#39;</span><span class="p">])</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">x_wrist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;min_wrist_yaw_rad&#39;</span><span class="p">])):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Fast motion turned on&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Fast motion turned off&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>

    <span class="c1"># ###################################################</span>
    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes base odometery based on stepper positions / velocities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes base odometery based on stepper positions / velocities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status_async</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status_async</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;left_wheel&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;right_wheel&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;left_wheel&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;right_wheel&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;translation_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#Deprecated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;rotation_torque&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#Deprecated</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_step</span><span class="p">:</span>
            <span class="c1"># Upon the first step, simply set the initial pose, since</span>
            <span class="c1"># no movement has yet been recorded.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_step</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">p0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">t0_s</span> <span class="o">=</span> <span class="n">t0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t1_s</span> <span class="o">=</span> <span class="n">t1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">######################################################</span>
            <span class="c1"># The odometry related was wrtten starting on January 14,</span>
            <span class="c1"># 2019 while looking at the following BSD-3-Clause licensed</span>
            <span class="c1"># code for reference.</span>

            <span class="c1"># https://github.com/merose/diff_drive/blob/master/src/diff_drive/odometry.py</span>

            <span class="c1"># The code uses standard calculations. The reference code</span>
            <span class="c1"># specifically cites a document with the following link,</span>
            <span class="c1"># which appears to be broken.</span>

            <span class="c1"># https://chess.eecs.berkeley.edu/eecs149/documentation/differentialDrive.pdf</span>

            <span class="c1"># There are many sources on the internet for these</span>
            <span class="c1"># equations. For example, the following document is</span>
            <span class="c1"># helpful:</span>

            <span class="c1"># http://www8.cs.umu.se/kurser/5DV122/HT13/material/Hellstrom-ForwardKinematics.pdf</span>

            <span class="n">prev_t0_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0_s</span>
            <span class="n">prev_t1_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t1_s</span>
            <span class="n">t0_s</span> <span class="o">=</span> <span class="n">t0</span>
            <span class="n">t1_s</span> <span class="o">=</span> <span class="n">t1</span>

            <span class="n">delta_t0_s</span> <span class="o">=</span> <span class="n">t0_s</span> <span class="o">-</span> <span class="n">prev_t0_s</span>
            <span class="n">delta_t1_s</span> <span class="o">=</span> <span class="n">t1_s</span> <span class="o">-</span> <span class="n">prev_t1_s</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">delta_t0_s</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">delta_t1_s</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="c1"># update if time has passed for both motor readings, otherwise do nothing</span>

                <span class="n">average_delta_t_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_t0_s</span> <span class="o">+</span> <span class="n">delta_t1_s</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

                <span class="c1"># update the times, since both motors have new readings</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_t0_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0_s</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_t1_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t1_s</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t0_s</span> <span class="o">=</span> <span class="n">t0_s</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t1_s</span> <span class="o">=</span> <span class="n">t1_s</span>

                <span class="c1"># need to check on wrap around / rollover for wheel positions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p0</span> <span class="o">=</span> <span class="n">p0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>

                <span class="c1"># Transform the wheel rotations so that left and right</span>
                <span class="c1"># wheel distances in meters have the convention that</span>
                <span class="c1"># positive values for each wheel corresponds with forward</span>
                <span class="c1"># motion of the mobile base.</span>
                <span class="n">prev_left_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_p0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meters_per_motor_rad</span>
                <span class="n">left_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meters_per_motor_rad</span>

                <span class="n">prev_right_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_p1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meters_per_motor_rad</span>
                <span class="n">right_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meters_per_motor_rad</span>

                <span class="n">delta_left_m</span> <span class="o">=</span> <span class="n">left_m</span> <span class="o">-</span> <span class="n">prev_left_m</span>
                <span class="n">delta_right_m</span> <span class="o">=</span> <span class="n">right_m</span> <span class="o">-</span> <span class="n">prev_right_m</span>

                <span class="n">delta_travel</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_right_m</span> <span class="o">+</span> <span class="n">delta_left_m</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">delta_theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_right_m</span> <span class="o">-</span> <span class="n">delta_left_m</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_separation_m</span>

                <span class="n">prev_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
                <span class="n">prev_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
                <span class="n">prev_theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">delta_left_m</span> <span class="o">==</span> <span class="n">delta_right_m</span><span class="p">:</span>
                    <span class="c1"># delta_theta is 0.0, which would result in a divide</span>
                    <span class="c1"># by zero error and corresponds with an infinite</span>
                    <span class="c1"># radius of curvature (0 curvature).</span>
                    <span class="n">delta_x</span> <span class="o">=</span> <span class="n">delta_travel</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">prev_theta</span><span class="p">)</span>
                    <span class="n">delta_y</span> <span class="o">=</span> <span class="n">delta_travel</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">prev_theta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># calculate the instantaneous center of curvature (ICC)</span>
                    <span class="n">icc_radius</span> <span class="o">=</span> <span class="n">delta_travel</span> <span class="o">/</span> <span class="n">delta_theta</span>
                    <span class="n">icc_x</span> <span class="o">=</span> <span class="n">prev_x</span> <span class="o">-</span> <span class="p">(</span><span class="n">icc_radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">prev_theta</span><span class="p">))</span>
                    <span class="n">icc_y</span> <span class="o">=</span> <span class="n">prev_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">icc_radius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">prev_theta</span><span class="p">))</span>

                    <span class="c1"># calculate the change in position based on the ICC</span>
                    <span class="n">delta_x</span> <span class="o">=</span> <span class="p">((</span><span class="n">cos</span><span class="p">(</span><span class="n">delta_theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_x</span> <span class="o">-</span> <span class="n">icc_x</span><span class="p">))</span>
                               <span class="o">-</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_y</span> <span class="o">-</span> <span class="n">icc_y</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">icc_x</span> <span class="o">-</span> <span class="n">prev_x</span><span class="p">)</span>

                    <span class="n">delta_y</span> <span class="o">=</span> <span class="p">((</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_x</span> <span class="o">-</span> <span class="n">icc_x</span><span class="p">))</span>
                               <span class="o">+</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">delta_theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_y</span> <span class="o">-</span> <span class="n">icc_y</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">icc_y</span> <span class="o">-</span> <span class="n">prev_y</span><span class="p">)</span>

                <span class="c1"># update the estimated total time passed since odometry started</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pose_time_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pose_time_s&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">average_delta_t_s</span>

                <span class="c1"># update the robot&#39;s velocity estimates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_travel</span> <span class="o">/</span> <span class="n">average_delta_t_s</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta_vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_theta</span> <span class="o">/</span> <span class="n">average_delta_t_s</span>

                <span class="c1"># update the robot&#39;s pose estimates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_x</span> <span class="o">+</span> <span class="n">delta_x</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_y</span> <span class="o">+</span> <span class="n">delta_y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_theta</span> <span class="o">+</span> <span class="n">delta_theta</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>

    <span class="c1"># ############## Deprecated Contact API ##################</span>

    <span class="k">def</span> <span class="nf">motor_current_to_translation_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="n">ir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method motor_current_to_translate_force has been deprecated since v0.3.5&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">motor_current_to_rotation_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="n">ir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method motor_current_to_rotation_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translation_force_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_N</span><span class="p">):</span>  <span class="c1"># Assume evenly balanced</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method translation_force_to_motor_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rotation_torque_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq_Nm</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method translation_force_to_motor_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>


    <span class="c1"># ########### Effort Contact Conversions ####################</span>
    <span class="c1"># Rotation effort is -100 to 100 (where 100 =  L/R motors at +iMax / +iMax)</span>
    <span class="c1"># Translation effort is -100 to 100 (where 100 =  L/R motors at +iMax / -iMax)</span>

    <span class="k">def</span> <span class="nf">rotation_effort_pct_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
        <span class="n">il</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">effort_pct_to_current</span><span class="p">(</span><span class="n">e_pct</span><span class="p">)</span>
        <span class="n">ir</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">effort_pct_to_current</span><span class="p">(</span><span class="n">e_pct</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">il</span><span class="p">,</span> <span class="n">ir</span>

    <span class="k">def</span> <span class="nf">translation_effort_pct_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
        <span class="n">il</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">effort_pct_to_current</span><span class="p">(</span><span class="n">e_pct</span><span class="p">)</span>
        <span class="n">ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">effort_pct_to_current</span><span class="p">(</span><span class="n">e_pct</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">il</span><span class="p">,</span> <span class="n">ir</span>

    <span class="k">def</span> <span class="nf">motor_current_to_translate_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">il</span><span class="p">,</span><span class="n">ir</span><span class="p">):</span>
        <span class="n">el</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
        <span class="n">er</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">el</span><span class="o">+</span><span class="n">er</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">motor_current_to_rotation_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">il</span><span class="p">,</span><span class="n">ir</span><span class="p">):</span>
        <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
        <span class="n">er</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">el</span><span class="o">-</span><span class="n">er</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1"># ########### Kinematic Conversions ####################</span>

    <span class="k">def</span> <span class="nf">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_m</span><span class="p">):</span>
        <span class="n">circ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_diameter_m&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">360</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">x_m</span><span class="o">/</span><span class="n">circ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">motor_rad_to_translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_r</span><span class="p">):</span>
        <span class="n">circ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_diameter_m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="n">x_r</span><span class="p">)</span><span class="o">*</span><span class="n">circ</span><span class="o">/</span><span class="mi">360</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">rotate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_r</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x_r</span> <span class="c1">#distance wheel travels (m)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">motor_rad_to_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_r</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor_rad_to_translate</span><span class="p">(</span><span class="n">x_r</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ang_rad</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span><span class="n">r</span>
        <span class="k">return</span> <span class="n">ang_rad</span>

    <span class="k">def</span> <span class="nf">translation_to_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_m</span><span class="p">):</span>
        <span class="n">x_mr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">x_m</span><span class="p">)</span>
        <span class="n">x_r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor_rad_to_rotate</span><span class="p">(</span><span class="n">x_mr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_r</span>

    <span class="k">def</span> <span class="nf">rotation_to_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_r</span><span class="p">):</span>
        <span class="n">x_mr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">x_r</span><span class="p">)</span>
        <span class="n">x_m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor_rad_to_translate</span><span class="p">(</span><span class="n">x_mr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_m</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.contact_thresh_to_motor_current" class="doc doc-heading">
<code class="highlight language-python"><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_translate</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>This model converts from a specified percentage effort (-100 to 100) of translate/rotational effort to motor currents</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">contact_thresh_to_motor_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">is_translate</span><span class="p">,</span><span class="n">contact_thresh</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This model converts from a specified percentage effort (-100 to 100) of translate/rotational effort to motor currents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_translate</span><span class="p">:</span>
        <span class="n">e_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_translate_default&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">contact_thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">contact_thresh</span>
        <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_translate_max&#39;</span><span class="p">]</span>
        <span class="n">i_l</span><span class="p">,</span> <span class="n">i_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation_effort_pct_to_motor_current</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">e_c</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">e_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_rotate_default&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">contact_thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">contact_thresh</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;contact_models&#39;</span><span class="p">][</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">][</span><span class="s1">&#39;contact_thresh_rotate_max&#39;</span><span class="p">]</span>
        <span class="n">i_l</span><span class="p">,</span> <span class="n">i_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_effort_pct_to_motor_current</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">e_c</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">m</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">i_l</span><span class="p">,</span><span class="n">i_r</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.enable_freewheel_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enable_freewheel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Force motors into freewheel</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">enable_freewheel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Force motors into freewheel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_freewheel</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_freewheel</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.enable_pos_incr_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enable_pos_incr_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Force motors into incremental position mode</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">enable_pos_incr_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Force motors into incremental position mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_pos_traj_incr</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_pos_traj_incr</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.follow_trajectory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Starts executing a waypoint trajectory</p>
<p><code>self.trajectory</code> must be populated with a valid trajectory before calling
this method.</p>
<h4 id="stretch_body.base.Base.follow_trajectory--parameters">Parameters</h4>
<p>v_r : float
    velocity limit for trajectory in motor space in meters per second
a_r : float
    acceleration limit for trajectory in motor space in meters per second squared
stiffness : float
    stiffness of motion. Range 0.0 (min) to 1.0 (max)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts executing a waypoint trajectory</span>

<span class="sd">    `self.trajectory` must be populated with a valid trajectory before calling</span>
<span class="sd">    this method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v_r : float</span>
<span class="sd">        velocity limit for trajectory in motor space in meters per second</span>
<span class="sd">    a_r : float</span>
<span class="sd">        acceleration limit for trajectory in motor space in meters per second squared</span>
<span class="sd">    stiffness : float</span>
<span class="sd">        stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;follow_trajectory&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

    <span class="c1"># check if joint valid, traj active, and right protocol</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base connection to hardware not valid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base waypoint trajectory already active&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Base left motor firmware version doesn&#39;t support waypoint trajectories&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Base right motor firmware version doesn&#39;t support waypoint trajectories&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check if trajectory valid</span>
    <span class="n">vel_limit</span> <span class="o">=</span> <span class="n">v_r</span> <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
    <span class="n">acc_limit</span> <span class="o">=</span> <span class="n">a_r</span> <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
    <span class="n">valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">vel_limit</span><span class="p">,</span> <span class="n">acc_limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Base trajectory not valid: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;must have at least two waypoints&quot;</span><span class="p">:</span>
        <span class="c1"># skip this device</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># set defaults</span>
    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>

    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]))</span> \
        <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]))</span> \
        <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">])</span>

    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

    <span class="c1"># start trajectory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">,</span>
                                <span class="n">v_des</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                                <span class="n">a_des</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="n">i_contact_l</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">,</span>
                                 <span class="n">v_des</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                                 <span class="n">a_des</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                 <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                 <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                 <span class="n">i_contact_neg</span><span class="o">=-</span><span class="n">i_contact_r</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
    <span class="n">ls0</span><span class="p">,</span> <span class="n">rs0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_wheel_segments</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">start_waypoint_trajectory</span><span class="p">(</span><span class="n">ls0</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">start_waypoint_trajectory</span><span class="p">(</span><span class="n">rs0</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>













  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.pull_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Computes base odometery based on stepper positions / velocities</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes base odometery based on stepper positions / velocities</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.pull_status_async" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Computes base odometery based on stepper positions / velocities</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes base odometery based on stepper positions / velocities</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">pull_status_async</span><span class="p">()</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">pull_status_async</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.reset_odometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset_odometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Reset X/Y/Theta to report 0</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reset_odometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reset X/Y/Theta to report 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_step</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.rotate_by" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rotate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Incremental rotation of the base
x_r: desired motion (radians)
v_r: velocity for trapezoidal motion profile (rad/s)
a_r: acceleration for trapezoidal motion profile (rad/s^2)
stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rotate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Incremental rotation of the base</span>
<span class="sd">    x_r: desired motion (radians)</span>
<span class="sd">    v_r: velocity for trapezoidal motion profile (rad/s)</span>
<span class="sd">    a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;rotate_by&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

    <span class="n">x_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">x_r</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
        <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_mr</span><span class="p">),</span><span class="n">v_mr_max</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_mr</span>

    <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">a_r</span><span class="p">)</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_mr</span><span class="p">),</span> <span class="n">a_mr_max</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
        <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_vel_m&#39;</span><span class="p">]),</span><span class="n">v_mr</span><span class="p">)</span>
        <span class="n">a_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_accel_m&#39;</span><span class="p">]),</span><span class="n">a_mr</span><span class="p">)</span>


    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span><span class="n">x_des</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">x_mr</span><span class="p">,</span>
                                <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span><span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                 <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                 <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                 <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                 <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                 <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.set_rotational_velocity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_rotational_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Command the bases rotational velocity.
Use care to prevent collisions / avoid runaways
v_r: desired rotational velocity (rad/s)
a_r: acceleration of motion profile (rad/s^2)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_rotational_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command the bases rotational velocity.</span>
<span class="sd">    Use care to prevent collisions / avoid runaways</span>
<span class="sd">    v_r: desired rotational velocity (rad/s)</span>
<span class="sd">    a_r: acceleration of motion profile (rad/s^2)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_rotational_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_mr_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">a_r</span><span class="p">)</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_mr</span><span class="p">),</span> <span class="n">a_mr_max</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

    <span class="n">w_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
    <span class="n">v_mr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
    <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
    <span class="n">v_mr</span> <span class="o">=</span> <span class="n">w_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_mr</span><span class="p">),</span> <span class="n">v_mr_max</span><span class="p">)</span>
    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                 <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                 <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                 <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.set_translate_velocity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_translate_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Command the bases translational velocity.
Use care to prevent collisions / avoid runaways
v_m: desired velocity (m/s)
a_m: acceleration of motion profile (m/s^2)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_translate_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command the bases translational velocity.</span>
<span class="sd">    Use care to prevent collisions / avoid runaways</span>
<span class="sd">    v_m: desired velocity (m/s)</span>
<span class="sd">    a_m: acceleration of motion profile (m/s^2)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_translate_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>
    <span class="n">v_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
    <span class="n">v_m</span> <span class="o">=</span> <span class="n">v_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
    <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>
    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                 <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                 <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                 <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.set_velocity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">w_r</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Command the bases translational and rotational
velocities simultaneously.
Use care to prevent collisions / avoid runaways
v_m: desired velocity (m/s)
w_r: desired rotational velocity (rad/s)
a:   acceleration of motion profile (m/s^2 and rad/s^2)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">w_r</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command the bases translational and rotational</span>
<span class="sd">    velocities simultaneously.</span>
<span class="sd">    Use care to prevent collisions / avoid runaways</span>
<span class="sd">    v_m: desired velocity (m/s)</span>
<span class="sd">    w_r: desired rotational velocity (rad/s)</span>
<span class="sd">    a:   acceleration of motion profile (m/s^2 and rad/s^2)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;set_velocity&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

    <span class="c1"># Unicycle dynamics w/o R because</span>
    <span class="c1"># translate_to_motor_rad accounts for R and gear ratio</span>
    <span class="n">wl_m</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">w_r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">wr_m</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;wheel_separation_m&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="n">wl_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">wl_m</span><span class="p">)</span>
    <span class="n">wl_m</span> <span class="o">=</span> <span class="n">wl_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wl_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
    <span class="n">wl_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">wl_m</span><span class="p">)</span>

    <span class="n">wr_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">wr_m</span><span class="p">)</span>
    <span class="n">wr_m</span> <span class="o">=</span> <span class="n">wr_sign</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wr_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
    <span class="n">wr_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">wr_m</span><span class="p">)</span>

    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>

    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_vel_traj&#39;</span><span class="p">]:</span>
        <span class="n">ctrl_mode</span> <span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctrl_mode</span> <span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_VEL_PID</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ctrl_mode</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">wl_r</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ctrl_mode</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="n">wr_r</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                 <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                 <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                 <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i_contact_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Starts machinery required to interface with this device</p>
<h4 id="stretch_body.base.Base.startup--parameters">Parameters</h4>
<p>threaded : bool
    whether a thread manages hardware polling/pushing in the background</p>
<h4 id="stretch_body.base.Base.startup--returns">Returns</h4>
<p>bool
    whether the startup procedure succeeded</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1">#Startup steppers first so that status is populated before this Device thread begins (if threaded==true)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">success</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.step_sentry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Only allow fast mobile base motion if the lift is low,
the arm is retracted, and the wrist is stowed. This is
intended to keep the center of mass low for increased
stability and avoid catching the arm or tool on
something.</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">robot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only allow fast mobile base motion if the lift is low,</span>
<span class="sd">    the arm is retracted, and the wrist is stowed. This is</span>
<span class="sd">    intended to keep the center of mass low for increased</span>
<span class="sd">    stability and avoid catching the arm or tool on</span>
<span class="sd">    something.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;base_max_velocity&#39;</span><span class="p">]:</span>
        <span class="n">x_lift</span><span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">x_arm</span> <span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">x_wrist</span> <span class="o">=</span><span class="n">robot</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;wrist_yaw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">x_lift</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;max_lift_height_m&#39;</span><span class="p">])</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">x_arm</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;max_arm_extension_m&#39;</span><span class="p">])</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">x_wrist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;min_wrist_yaw_rad&#39;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Fast motion turned on&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Fast motion turned off&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">step_sentry</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.stop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Shuts down machinery started in <code>startup()</code></p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.stop_trajectory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Stop waypoint trajectory immediately and resets hardware</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop waypoint trajectory immediately and resets hardware</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">stop_waypoint_trajectory</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.translate_by" class="doc doc-heading">
<code class="highlight language-python"><span class="n">translate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">v_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Incremental translation of the base
x_m: desired motion (m)
v_m: velocity for trapezoidal motion profile (m/s)
a_m: acceleration for trapezoidal motion profile (m/s^2)
stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)
contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)
contact_thresh: effort to stop at (units of effort_pct (-100, 100))</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">translate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">v_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">contact_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Incremental translation of the base</span>
<span class="sd">    x_m: desired motion (m)</span>
<span class="sd">    v_m: velocity for trapezoidal motion profile (m/s)</span>
<span class="sd">    a_m: acceleration for trapezoidal motion profile (m/s^2)</span>
<span class="sd">    stiffness: stiffness of motion. Range 0.0 (min) to 1.0 (max)</span>
<span class="sd">    contact_thresh_N: (deprecated) effort to stop at (units of pseudo_N)</span>
<span class="sd">    contact_thresh: effort to stop at (units of effort_pct (-100, 100))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_deprecated_contact_model_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;translate_by&#39;</span><span class="p">,</span> <span class="n">contact_thresh_N</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="p">)</span>

    <span class="n">x_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">x_m</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">v_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_m&#39;</span><span class="p">])</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">v_m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_mr</span>

    <span class="k">if</span> <span class="n">a_m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_m&#39;</span><span class="p">])</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_mr</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_motion_allowed</span><span class="p">:</span>
        <span class="n">v_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_vel_m&#39;</span><span class="p">]),</span><span class="n">v_mr</span><span class="p">)</span>
        <span class="n">a_mr</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sentry_max_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;limit_accel_m&#39;</span><span class="p">]),</span><span class="n">a_mr</span><span class="p">)</span>

    <span class="n">i_contact_l</span><span class="p">,</span> <span class="n">i_contact_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_thresh_to_motor_current</span><span class="p">(</span><span class="n">is_translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contact_thresh</span><span class="o">=</span><span class="n">contact_thresh</span><span class="p">)</span>

    <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span> <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_l</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">i_contact_l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="n">x_mr</span><span class="p">,</span>
                                <span class="n">v_des</span><span class="o">=</span><span class="n">v_mr</span><span class="p">,</span>
                                <span class="n">a_des</span><span class="o">=</span><span class="n">a_mr</span><span class="p">,</span>
                                <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">,</span>
                                <span class="n">i_feedforward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">i_contact_pos</span><span class="o">=</span><span class="n">i_contact_r</span><span class="p">,</span>
                                <span class="n">i_contact_neg</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">i_contact_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h2 id="stretch_body.base.Base.update_trajectory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Updates hardware with the next segment of <code>self.trajectory</code></p>
<p>This method must be called frequently to enable complete trajectory execution
and preemption of future segments. If used with <code>stretch_body.robot.Robot</code> or
with <code>self.startup(threaded=True)</code>, a background thread is launched for this.
Otherwise, the user must handle calling this method.</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/base.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates hardware with the next segment of `self.trajectory`</span>

<span class="sd">    This method must be called frequently to enable complete trajectory execution</span>
<span class="sd">    and preemption of future segments. If used with `stretch_body.robot.Robot` or</span>
<span class="sd">    with `self.startup(threaded=True)`, a background thread is launched for this.</span>
<span class="sd">    Otherwise, the user must handle calling this method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if joint valid, right protocol, and right mode</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span>
        <span class="n">next_segment_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># subtract 2 due to IDs 0 &amp; 1 being reserved by firmware</span>
        <span class="k">if</span> <span class="n">next_segment_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">():</span>
            <span class="n">ls1</span><span class="p">,</span> <span class="n">rs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">get_wheel_segments</span><span class="p">(</span><span class="n">next_segment_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_to_motor_rad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_to_motor_rad</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">set_next_trajectory_segment</span><span class="p">(</span><span class="n">ls1</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">set_next_trajectory_segment</span><span class="p">(</span><span class="n">rs1</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idle&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idle&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Stepper</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_lwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_rwpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wheel</span><span class="o">.</span><span class="n">enable_pos_traj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wheel</span><span class="o">.</span><span class="n">enable_pos_traj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>

<h3 id="using-the-head-class">Using the Head class</h3>
<p><img alt="Stretch head blueprint" src="../images/tilt_detail_rs.png#only-light" />
<img alt="Stretch head blueprint" src="../images/tilt_detail_rs.png#only-dark" /></p>
<p>The interface to Stretch's head is the <a href="#stretch_body.head.Head">Head</a> class. The head contains an Intel Realsense D435i depth camera. The pan and tilt joints in the head allow Stretch to swivel and capture depth imagery of its surrounding. The head is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.head</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">Head</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">startup</span><span class="p">():</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start head!</span>

<span class="n">h</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

<span class="c1"># interact with the head here</span>
</code></pre></div></td></tr></table></div>
<p><a href="#stretch_body.head.Head">Head</a> is a subclass of the <a href="#stretch_body.dynamixel_X_chain.DynamixelXChain">DynamixelXChain</a> class, which in turn is a subclass of the <a href="#stretch_body.device.Device">Device</a> class. Therefore, some of <a href="#stretch_body.head.Head">Head's</a> methods, such as <a href="#stretch_body.head.Head.startup"><code>startup()</code></a> and <a href="#stretch_body.head.Head.home"><code>home()</code></a> are extended from the <a href="#stretch_body.device.Device">Device</a> class, while others come from the <a href="#stretch_body.dynamixel_X_chain.DynamixelXChain">DynamixelXChain</a> class. Reading the head's current state and sending commands to its revolute joints (head pan and tilt) can be achieved using:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">starting_position</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;head_pan&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>

<span class="c1"># look right by 90 degrees</span>
<span class="n">h</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="n">starting_position</span> <span class="o">+</span> <span class="mf">1.57</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>

<span class="c1"># tilt up by 30 degrees</span>
<span class="n">h</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.57</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">()</span>

<span class="c1"># look down towards the wheels</span>
<span class="n">h</span><span class="o">.</span><span class="n">pose</span><span class="p">(</span><span class="s1">&#39;wheels&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># look ahead</span>
<span class="n">h</span><span class="o">.</span><span class="n">pose</span><span class="p">(</span><span class="s1">&#39;ahead&#39;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The attribute <code>status</code> is a dictionary of dictionaries, where each subdictionary is the status of one of the head's joints. This state information is updated in the background in real-time by default (disable by initializing as <a href="#stretch_body.head.Head.startup"><code>startup(threading=False)</code></a>). Use the <a href="#stretch_body.head.Head.pretty_print"><code>pretty_print()</code></a> method to print out this state information in a human-interpretable format. </p>
<p>Commanding the head's revolute joints is done through the <a href="#stretch_body.head.Head.move_to"><code>move_to()</code></a> and <a href="#stretch_body.head.Head.move_by"><code>move_by()</code></a> methods. Notice that, unlike the previous joints, no push command call is required here. These joints are Dynamixel servos, which behave differently than the Hello Robot steppers. Their commands are not queued and are executed as soon as they're received.</p>
<p><a href="#stretch_body.head.Head">Head's</a> two joints, the 'head_pan' and 'head_tilt' are instances of the <a href="#stretch_body.dynamixel_hello_XL430.DynamixelHelloXL430">DynamixelHelloXL430</a> class and are retrievable using the <a href="#stretch_body.head.Head.get_joint"><code>get_joint()</code></a> method. They have the <a href="#stretch_body.dynamixel_hello_XL430.DynamixelHelloXL430.wait_until_at_setpoint"><code>wait_until_at_setpoint()</code></a> method, which blocks program execution until the joint reaches the commanded goal.</p>
<p>The <a href="#stretch_body.head.Head.pose"><code>pose()</code></a> method makes it easy to command the head to common head poses (e.g. looking 'ahead', at the end-of-arm 'tool', obstacles in front of the 'wheels', or 'up').</p>
<p>The head supports waypoint trajectories as well:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># queue a trajectory consisting of three waypoints</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=-</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t_s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x_r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># trigger trajectory execution</span>
<span class="n">h</span><span class="o">.</span><span class="n">follow_trajectory</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">;</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The head pan and tilt <a href="#stretch_body.dynamixel_hello_XL430.DynamixelHelloXL430">DynamixelHelloXL430</a> instances have an attribute <code>trajectory</code>, which is an instance of the <a href="#stretch_body.trajectories.RevoluteTrajectory">RevoluteTrajectory</a> class. The call to <a href="#stretch_body.dynamixel_X_chain.DynamixelXChain.follow_trajectory"><code>follow_trajectory()</code></a> begins software tracking of the spline.</p>
<p>Finally, setting soft motion limits for the head's pan and tilt range can be achieved using:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># clip the head_pan&#39;s range</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_soft_motion_limit_min</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_soft_motion_limit_max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># clip the head_tilt&#39;s range</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_soft_motion_limit_min</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_soft_motion_limit_max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <a href="#stretch_body.dynamixel_X_chain.DynamixelXChain.set_soft_motion_limit_min"><code>set_soft_motion_limit_min/max()</code></a> methods perform clipping of the joint's range at the software level (cannot persist across reboots).</p>
<p>All methods of the <a href="#stretch_body.head.Head">Head</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.head.Head"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch RE1 Head</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Head</span><span class="p">(</span><span class="n">DynamixelXChain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch RE1 Head</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">usb</span> <span class="o">=</span> <span class="n">RobotParams</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;head&#39;</span><span class="p">][</span><span class="s1">&#39;usb_name&#39;</span><span class="p">]</span>
        <span class="n">DynamixelXChain</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;head&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="s1">&#39;head_tilt&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_motor</span><span class="p">(</span><span class="n">DynamixelHelloXL430</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poses</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ahead&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;back&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">),</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                      <span class="s1">&#39;tool&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="o">-</span><span class="mi">45</span><span class="p">)],</span>
                      <span class="s1">&#39;wheels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">)],</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                      <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">30</span><span class="p">)]}</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DynamixelXChain</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves joint by name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        joint_name : str</span>
<span class="sd">            valid joints defined in ``joints``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DynamixelHelloXL430 or None</span>
<span class="sd">            Motor object on valid joint name, else None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_motor</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: Name of the joint to move (&#39;head_pan&#39; or &#39;head_tilt&#39;)</span>
<span class="sd">        x_r: commanded absolute position (radians).</span>
<span class="sd">        v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">        a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span>  <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: Name of the joint to move (&#39;head_pan&#39; or &#39;head_tilt&#39;)</span>
<span class="sd">        x_r: commanded incremental motion (radians).</span>
<span class="sd">        v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">        a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: name of joint (string)</span>
<span class="sd">        v_r: commanded velocity (rad/s).</span>
<span class="sd">        a_r: acceleration motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;head_pan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;head_pan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="n">single_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="n">single_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">a_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        p: Dictionary key to named pose (eg &#39;ahead&#39;)</span>
<span class="sd">        v_r: list, velocities for trapezoidal motion profile (rad/s).</span>
<span class="sd">        a_r: list, accelerations for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poses</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poses</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.get_joint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Retrieves joint by name.</p>
<h4 id="stretch_body.head.Head.get_joint--parameters">Parameters</h4>
<p>joint_name : str
    valid joints defined in <code>joints</code></p>
<h4 id="stretch_body.head.Head.get_joint--returns">Returns</h4>
<p>DynamixelHelloXL430 or None
    Motor object on valid joint name, else None</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves joint by name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    joint_name : str</span>
<span class="sd">        valid joints defined in ``joints``</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DynamixelHelloXL430 or None</span>
<span class="sd">        Motor object on valid joint name, else None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_motor</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.move_by" class="doc doc-heading">
<code class="highlight language-python"><span class="n">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: Name of the joint to move ('head_pan' or 'head_tilt')
x_r: commanded incremental motion (radians).
v_r: velocity for trapezoidal motion profile (rad/s).
a_r: acceleration for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span>  <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: Name of the joint to move (&#39;head_pan&#39; or &#39;head_tilt&#39;)</span>
<span class="sd">    x_r: commanded incremental motion (radians).</span>
<span class="sd">    v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">    a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.move_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: Name of the joint to move ('head_pan' or 'head_tilt')
x_r: commanded absolute position (radians).
v_r: velocity for trapezoidal motion profile (rad/s).
a_r: acceleration for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: Name of the joint to move (&#39;head_pan&#39; or &#39;head_tilt&#39;)</span>
<span class="sd">    x_r: commanded absolute position (radians).</span>
<span class="sd">    v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">    a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.pose" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">a_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>p: Dictionary key to named pose (eg 'ahead')
v_r: list, velocities for trapezoidal motion profile (rad/s).
a_r: list, accelerations for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">a_r</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    p: Dictionary key to named pose (eg &#39;ahead&#39;)</span>
<span class="sd">    v_r: list, velocities for trapezoidal motion profile (rad/s).</span>
<span class="sd">    a_r: list, accelerations for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_pan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poses</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="s1">&#39;head_tilt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poses</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.set_velocity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: name of joint (string)
v_r: commanded velocity (rad/s).
a_r: acceleration motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: name of joint (string)</span>
<span class="sd">    v_r: commanded velocity (rad/s).</span>
<span class="sd">    a_r: acceleration motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.head.Head.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Starts machinery required to interface with this device</p>
<h4 id="stretch_body.head.Head.startup--parameters">Parameters</h4>
<p>threaded : bool
    whether a thread manages hardware polling/pushing in the background</p>
<h4 id="stretch_body.head.Head.startup--returns">Returns</h4>
<p>bool
    whether the startup procedure succeeded</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/head.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DynamixelXChain</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h3 id="using-the-endofarm-class">Using the EndOfArm class</h3>
<p>The interface to Stretch's end-of-arm is the <a href="#stretch_body.end_of_arm.EndOfArm">EndOfArm</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.end_of_arm</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">end_of_arm</span><span class="o">.</span><span class="n">EndOfArm</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start end of arm!</span>

<span class="c1"># interact with the end of arm here</span>

<span class="n">e</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>All methods of the <a href="#stretch_body.end_of_arm.EndOfArm">EndOfArm</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.end_of_arm.EndOfArm"></a>
    <div class="doc doc-contents first">

      <p>The EndOfArm class allows for an extensible serial chain of Dynamixel X series devices
It allows the specific type of device to be declared at runtime via the Yaml parameters
In this way, a user can add their own custom Dynamixel based tools to the robot end-of-arm by
simply deriving it from DynamixelHelloXL430 and declaring the class name / Python module name
in the User YAML file</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EndOfArm</span><span class="p">(</span><span class="n">DynamixelXChain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The EndOfArm class allows for an extensible serial chain of Dynamixel X series devices</span>
<span class="sd">    It allows the specific type of device to be declared at runtime via the Yaml parameters</span>
<span class="sd">    In this way, a user can add their own custom Dynamixel based tools to the robot end-of-arm by</span>
<span class="sd">    simply deriving it from DynamixelHelloXL430 and declaring the class name / Python module name</span>
<span class="sd">    in the User YAML file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;end_of_arm&#39;</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">usb</span> <span class="o">=</span> <span class="n">RobotParams</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;end_of_arm&#39;</span><span class="p">][</span><span class="s1">&#39;usb_name&#39;</span><span class="p">]</span>
        <span class="n">DynamixelXChain</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;devices&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;devices&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;py_module_name&#39;</span><span class="p">]</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;devices&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;py_class_name&#39;</span><span class="p">]</span>
            <span class="n">dynamixel_device</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">),</span> <span class="n">class_name</span><span class="p">)(</span><span class="n">chain</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_motor</span><span class="p">(</span><span class="n">dynamixel_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urdf_map</span><span class="o">=</span><span class="p">{}</span> <span class="c1">#Override</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DynamixelXChain</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves joint by name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        joint_name : str</span>
<span class="sd">            valid joints defined as defined in params[&#39;devices&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DynamixelHelloXL430 or None</span>
<span class="sd">            Motor object on valid joint name, else None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_motor</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: name of joint (string)</span>
<span class="sd">        x_r: commanded absolute position (radians).</span>
<span class="sd">        v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">        a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span>  <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: name of joint (string)</span>
<span class="sd">        x_r: commanded incremental motion (radians).</span>
<span class="sd">        v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">        a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        joint: name of joint (string)</span>
<span class="sd">        v_r: commanded velocity (rad/s).</span>
<span class="sd">        a_r: acceleration motion profile (rad/s^2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">joint</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span><span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                joint: name of joint (string)</span>
<span class="sd">                p: named pose of joint</span>
<span class="sd">                v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">                a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">pose</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1">#Override by specific tool</span>

    <span class="k">def</span> <span class="nf">pre_stow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">robot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1">#Override by specific tool</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Home to hardstops</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing </span><span class="si">%s</span><span class="s1"> ----&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_tool_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">class_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return true if the given tool type is present (eg. StretchGripper)</span>
<span class="sd">        Allows for conditional logic when switching end-of-arm tools</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">class_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;devices&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;py_class_name&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_joint_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">brake_joints</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a dictionary of tools current pose (for robot_collision_mgmt)</span>
<span class="sd">        Keys match joint names in URDF</span>
<span class="sd">        Specific tools should define urdf_map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdf_map</span><span class="p">:</span>
            <span class="n">jn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdf_map</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="n">jn</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">brake_joints</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;collision_mgmt&#39;</span><span class="p">][</span><span class="s1">&#39;k_brake_distance&#39;</span><span class="p">][</span><span class="n">jn</span><span class="p">]</span> <span class="o">*</span> <span class="n">motor</span><span class="o">.</span><span class="n">get_braking_distance</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">dx</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>

        <span class="n">gripper_joint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;gripper&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">gripper_joint</span> <span class="o">=</span> <span class="n">j</span>

        <span class="k">if</span> <span class="n">gripper_joint</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">brake_joints</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">brake_joints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;gripper&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;collision_mgmt&#39;</span><span class="p">][</span><span class="s1">&#39;k_brake_distance&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">finger_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="n">gripper_joint</span><span class="p">)</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;gripper_conversion&#39;</span><span class="p">][</span><span class="s1">&#39;finger_rad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;joint_gripper_finger_left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finger_angle</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;joint_gripper_finger_right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finger_angle</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">pre_stow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">robot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.get_joint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Retrieves joint by name.</p>
<h4 id="stretch_body.end_of_arm.EndOfArm.get_joint--parameters">Parameters</h4>
<p>joint_name : str
    valid joints defined as defined in params['devices']</p>
<h4 id="stretch_body.end_of_arm.EndOfArm.get_joint--returns">Returns</h4>
<p>DynamixelHelloXL430 or None
    Motor object on valid joint name, else None</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves joint by name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    joint_name : str</span>
<span class="sd">        valid joints defined as defined in params[&#39;devices&#39;]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DynamixelHelloXL430 or None</span>
<span class="sd">        Motor object on valid joint name, else None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_motor</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.get_joint_configuration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_joint_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brake_joints</span><span class="o">=</span><span class="p">{})</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Construct a dictionary of tools current pose (for robot_collision_mgmt)
Keys match joint names in URDF
Specific tools should define urdf_map</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_joint_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">brake_joints</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a dictionary of tools current pose (for robot_collision_mgmt)</span>
<span class="sd">    Keys match joint names in URDF</span>
<span class="sd">    Specific tools should define urdf_map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdf_map</span><span class="p">:</span>
        <span class="n">jn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdf_map</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="n">jn</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">brake_joints</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;collision_mgmt&#39;</span><span class="p">][</span><span class="s1">&#39;k_brake_distance&#39;</span><span class="p">][</span><span class="n">jn</span><span class="p">]</span> <span class="o">*</span> <span class="n">motor</span><span class="o">.</span><span class="n">get_braking_distance</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dx</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>

    <span class="n">gripper_joint</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;gripper&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">gripper_joint</span> <span class="o">=</span> <span class="n">j</span>

    <span class="k">if</span> <span class="n">gripper_joint</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">brake_joints</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">brake_joints</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;gripper&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;collision_mgmt&#39;</span><span class="p">][</span><span class="s1">&#39;k_brake_distance&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">finger_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint</span><span class="p">(</span><span class="n">gripper_joint</span><span class="p">)</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;gripper_conversion&#39;</span><span class="p">][</span><span class="s1">&#39;finger_rad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;joint_gripper_finger_left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finger_angle</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;joint_gripper_finger_right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finger_angle</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.home" class="doc doc-heading">
<code class="highlight language-python"><span class="n">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Home to hardstops</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Home to hardstops</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">joint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Homing </span><span class="si">%s</span><span class="s1"> ----&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.is_tool_present" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_tool_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Return true if the given tool type is present (eg. StretchGripper)
Allows for conditional logic when switching end-of-arm tools</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_tool_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">class_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return true if the given tool type is present (eg. StretchGripper)</span>
<span class="sd">    Allows for conditional logic when switching end-of-arm tools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">class_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;devices&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;py_class_name&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.move_by" class="doc doc-heading">
<code class="highlight language-python"><span class="n">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: name of joint (string)
x_r: commanded incremental motion (radians).
v_r: velocity for trapezoidal motion profile (rad/s).
a_r: acceleration for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: name of joint (string)</span>
<span class="sd">    x_r: commanded incremental motion (radians).</span>
<span class="sd">    v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">    a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_by</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.move_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: name of joint (string)
x_r: commanded absolute position (radians).
v_r: velocity for trapezoidal motion profile (rad/s).
a_r: acceleration for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: name of joint (string)</span>
<span class="sd">    x_r: commanded absolute position (radians).</span>
<span class="sd">    v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">    a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span>  <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.pose" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: name of joint (string)
p: named pose of joint
v_r: velocity for trapezoidal motion profile (rad/s).
a_r: acceleration for trapezoidal motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">joint</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span><span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            joint: name of joint (string)</span>
<span class="sd">            p: named pose of joint</span>
<span class="sd">            v_r: velocity for trapezoidal motion profile (rad/s).</span>
<span class="sd">            a_r: acceleration for trapezoidal motion profile (rad/s^2)</span>
<span class="sd">            &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">pose</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.set_velocity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>joint: name of joint (string)
v_r: commanded velocity (rad/s).
a_r: acceleration motion profile (rad/s^2)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    joint: name of joint (string)</span>
<span class="sd">    v_r: commanded velocity (rad/s).</span>
<span class="sd">    a_r: acceleration motion profile (rad/s^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">joint</span><span class="p">]</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="n">a_r</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="stretch_body.end_of_arm.EndOfArm.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Starts machinery required to interface with this device</p>
<h4 id="stretch_body.end_of_arm.EndOfArm.startup--parameters">Parameters</h4>
<p>threaded : bool
    whether a thread manages hardware polling/pushing in the background</p>
<h4 id="stretch_body.end_of_arm.EndOfArm.startup--returns">Returns</h4>
<p>bool
    whether the startup procedure succeeded</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/end_of_arm.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DynamixelXChain</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

<h3 id="using-the-wacc-class">Using the Wacc class</h3>
<p>The interface to Stretch's wrist board is the <a href="#stretch_body.wacc.Wacc">Wacc</a> (wrist + accelerometer) class. This board provides an Arduino and accelerometer sensor that is accessible from the <a href="#stretch_body.wacc.Wacc">Wacc</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.wacc</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">wacc</span><span class="o">.</span><span class="n">Wacc</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start wacc!</span>

<span class="c1"># interact with the wacc here</span>

<span class="n">w</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>All methods of the <a href="#stretch_body.wacc.Wacc">Wacc</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.wacc.Wacc"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Wrist Accelerometer (Wacc) Board</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/wacc.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Wacc</span><span class="p">(</span><span class="n">WaccBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Wrist Accelerometer (Wacc) Board</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext_status_cb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext_command_cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">WaccBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="n">usb</span><span class="p">,</span> <span class="n">ext_status_cb</span><span class="o">=</span><span class="n">ext_status_cb</span><span class="p">,</span> <span class="n">ext_command_cb</span><span class="o">=</span><span class="n">ext_command_cb</span><span class="p">)</span>
        <span class="c1">#Order in descending order so more recent protocols/methods override less recent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Wacc_Protocol_P0</span><span class="p">,),</span> <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Wacc_Protocol_P1</span><span class="p">,</span> <span class="n">Wacc_Protocol_P0</span><span class="p">),</span><span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Wacc_Protocol_P2</span><span class="p">,</span> <span class="n">Wacc_Protocol_P1</span><span class="p">,</span> <span class="n">Wacc_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Wacc_Protocol_P3</span><span class="p">,</span> <span class="n">Wacc_Protocol_P2</span><span class="p">,</span> <span class="n">Wacc_Protocol_P1</span><span class="p">,</span> <span class="n">Wacc_Protocol_P0</span><span class="p">,),}</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First determine which protocol version the uC firmware is running.</span>
<span class="sd">        Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WaccBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
                <span class="n">Wacc</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                    ----------------</span>
<span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
<span class="s2">                                    Please power cycle the robot and try again.</span>
<span class="s2">                                    ----------------</span>
<span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    ----------------</span>
<span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
<span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
<span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
<span class="s2">                    Disabling device.</span>
<span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
<span class="s2">                    ----------------</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.wacc.Wacc.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>First determine which protocol version the uC firmware is running.
Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/wacc.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    First determine which protocol version the uC firmware is running.</span>
<span class="sd">    Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WaccBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
            <span class="n">Wacc</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                ----------------</span>
<span class="s2">                                Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
<span class="s2">                                Please power cycle the robot and try again.</span>
<span class="s2">                                ----------------</span>
<span class="s2">                                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                ----------------</span>
<span class="s2">                Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
<span class="s2">                Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
<span class="s2">                Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
<span class="s2">                Disabling device.</span>
<span class="s2">                Please upgrade the firmware and/or version of Stretch Body.</span>
<span class="s2">                ----------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h3 id="using-the-pimu-class">Using the Pimu class</h3>
<p>The interface to Stretch's power board is the <a href="#stretch_body.pimu.Pimu">Pimu</a> (power + IMU) class. This board provides a 9-DOF IMU that is accessible from the <a href="#stretch_body.pimu.Pimu">Pimu</a> class. It is typically initialized as:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">stretch_body.pimu</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">stretch_body</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">Pimu</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">exit</span><span class="p">()</span> <span class="c1"># failed to start pimu!</span>

<span class="c1"># interact with the pimu here</span>

<span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>All methods of the <a href="#stretch_body.pimu.Pimu">Pimu</a> class are documented below.</p>


  <div class="doc doc-object doc-class">

<a id="stretch_body.pimu.Pimu"></a>
    <div class="doc doc-contents first">

      <p>API to the Stretch Power and IMU board (Pimu)</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/pimu.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Pimu</span><span class="p">(</span><span class="n">PimuBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API to the Stretch Power and IMU board (Pimu)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">PimuBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_reset</span><span class="p">,</span><span class="n">usb</span><span class="p">)</span>
        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P2</span><span class="p">,</span> <span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P3</span><span class="p">,</span> <span class="n">Pimu_Protocol_P2</span><span class="p">,</span> <span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P4</span><span class="p">,</span> <span class="n">Pimu_Protocol_P3</span><span class="p">,</span> <span class="n">Pimu_Protocol_P2</span><span class="p">,</span> <span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p5&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P5</span><span class="p">,</span> <span class="n">Pimu_Protocol_P4</span><span class="p">,</span> <span class="n">Pimu_Protocol_P3</span><span class="p">,</span> <span class="n">Pimu_Protocol_P2</span><span class="p">,</span> <span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,),</span>
                                    <span class="s1">&#39;p6&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Pimu_Protocol_P6</span><span class="p">,</span> <span class="n">Pimu_Protocol_P5</span><span class="p">,</span> <span class="n">Pimu_Protocol_P4</span><span class="p">,</span> <span class="n">Pimu_Protocol_P3</span><span class="p">,</span> <span class="n">Pimu_Protocol_P2</span><span class="p">,</span> <span class="n">Pimu_Protocol_P1</span><span class="p">,</span> <span class="n">Pimu_Protocol_P0</span><span class="p">,)</span>
                                    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First determine which protocol version the uC firmware is running.</span>
<span class="sd">        Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PimuBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
                <span class="n">Pimu</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
                <span class="n">IMU</span><span class="o">.</span><span class="vm">__bases__</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imu</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                    ----------------</span>
<span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
<span class="s2">                                    Please power cycle the robot and try again.</span>
<span class="s2">                                    ----------------</span>
<span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    ----------------</span>
<span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
<span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
<span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
<span class="s2">                    Disabling device.</span>
<span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
<span class="s2">                    ----------------</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="stretch_body.pimu.Pimu.startup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>First determine which protocol version the uC firmware is running.
Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</p>

        <details class="quote">
          <summary>Source code in <code>stretch_body/pimu.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    First determine which protocol version the uC firmware is running.</span>
<span class="sd">    Based on that version, replaces PimuBase class inheritance with a inheritance to a child class of PimuBase that supports that protocol</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PimuBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
            <span class="n">Pimu</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
            <span class="n">IMU</span><span class="o">.</span><span class="vm">__bases__</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imu</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                ----------------</span>
<span class="s2">                                Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
<span class="s2">                                Please power cycle the robot and try again.</span>
<span class="s2">                                ----------------</span>
<span class="s2">                                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                ----------------</span>
<span class="s2">                Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
<span class="s2">                Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
<span class="s2">                Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
<span class="s2">                Disabling device.</span>
<span class="s2">                Please upgrade the firmware and/or version of Stretch Body.</span>
<span class="s2">                ----------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<hr />
<div align="center"> All materials are Copyright 2022 by Hello Robot Inc. Hello Robot and Stretch are registered trademarks.</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../tutorial_command_line_tools/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Command line Tools">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Command line Tools
              </div>
            </div>
          </a>
        
        
          
          <a href="../tutorial_robot_motion/" class="md-footer__link md-footer__link--next" aria-label="Next: Robot Motion">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Robot Motion
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Hello Robot Inc
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hello-robot.com" target="_blank" rel="noopener" title="hello-robot.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/HelloRobotInc" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/hello-robot" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/hello-robot-inc" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../../extra.js"></script>
      
    
  </body>
</html>